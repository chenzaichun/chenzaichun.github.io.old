<!doctype html><html lang=zh-cn><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge,chrome=1"><title>高可用部署cmp相关脚本 - 木哈哈--瞎折腾</title><meta name=renderer content="webkit"><meta name=viewport content="width=device-width,initial-scale=1,maximum-scale=1"><meta http-equiv=cache-control content="no-transform"><meta http-equiv=cache-control content="no-siteapp"><meta name=theme-color content="#f8f5ec"><meta name=msapplication-navbutton-color content="#f8f5ec"><meta name=apple-mobile-web-app-capable content="yes"><meta name=apple-mobile-web-app-status-bar-style content="#f8f5ec"><meta name=author content="Chen, Zai-Chun"><meta name=description content="Table of Contents 高可用部署cmp相关脚本 rightcloud_var_ha rightcloud_env_ha 数据库初始化 注入ip相关的配置 db migration 禁用云环境 运行 高可用部署cmp相关脚本 对于基础组件的部署配置，请参考高可"><meta name=keywords content="Hugo,theme,even,emacs,programming,linux,go,java,python,spring,hadoop,ai"><meta name=generator content="Hugo 0.85.0 with theme even"><link rel=canonical href=https://chenzaichun.github.io/post/ha_deploy/><link rel=apple-touch-icon sizes=180x180 href=/apple-touch-icon.png><link rel=icon type=image/png sizes=32x32 href=/favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=/favicon-16x16.png><link rel=manifest href=/manifest.json><link rel=mask-icon href=/safari-pinned-tab.svg color=#5bbad5><link href=/sass/main.min.f92fd13721ddf72129410fd8250e73152cc6f2438082b6c0208dc24ee7c13fc4.css rel=stylesheet><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@3.1.20/dist/jquery.fancybox.min.css integrity="sha256-7TyXnr2YU040zfSP+rEcz29ggW4j56/ujTPwjMzyqFY=" crossorigin=anonymous><meta property="og:title" content="高可用部署cmp相关脚本"><meta property="og:description" content="Table of Contents 高可用部署cmp相关脚本 rightcloud_var_ha rightcloud_env_ha 数据库初始化 注入ip相关的配置 db migration 禁用云环境 运行 高可用部署cmp相关脚本 对于基础组件的部署配置，请参考高可"><meta property="og:type" content="article"><meta property="og:url" content="https://chenzaichun.github.io/post/ha_deploy/"><meta property="article:section" content="post"><meta itemprop=name content="高可用部署cmp相关脚本"><meta itemprop=description content="Table of Contents 高可用部署cmp相关脚本 rightcloud_var_ha rightcloud_env_ha 数据库初始化 注入ip相关的配置 db migration 禁用云环境 运行 高可用部署cmp相关脚本 对于基础组件的部署配置，请参考高可"><meta itemprop=wordCount content="3974"><meta itemprop=keywords content><meta name=twitter:card content="summary"><meta name=twitter:title content="高可用部署cmp相关脚本"><meta name=twitter:description content="Table of Contents 高可用部署cmp相关脚本 rightcloud_var_ha rightcloud_env_ha 数据库初始化 注入ip相关的配置 db migration 禁用云环境 运行 高可用部署cmp相关脚本 对于基础组件的部署配置，请参考高可"><!--[if lte IE 9]><script src=https://cdnjs.cloudflare.com/ajax/libs/classlist/1.1.20170427/classList.min.js></script><![endif]--><!--[if lt IE 9]><script src=https://cdn.jsdelivr.net/npm/html5shiv@3.7.3/dist/html5shiv.min.js></script><script src=https://cdn.jsdelivr.net/npm/respond.js@1.4.2/dest/respond.min.js></script><![endif]--></head><body><div id=mobile-navbar class=mobile-navbar><div class=mobile-header-logo><a href=/ class=logo>Even</a></div><div class=mobile-navbar-icon><span></span><span></span><span></span></div></div><nav id=mobile-menu class="mobile-menu slideout-menu"><ul class=mobile-menu-list><a href=/><li class=mobile-menu-item>Home</li></a><a href=/post/><li class=mobile-menu-item>Archives</li></a><a href=/tags/><li class=mobile-menu-item>Tags</li></a><a href=/categories/><li class=mobile-menu-item>Categories</li></a></ul></nav><div class=container id=mobile-panel><header id=header class=header><div class=logo-wrapper><a href=/ class=logo>Even</a></div><nav class=site-navbar><ul id=menu class=menu><li class=menu-item><a class=menu-item-link href=/>Home</a></li><li class=menu-item><a class=menu-item-link href=/post/>Archives</a></li><li class=menu-item><a class=menu-item-link href=/tags/>Tags</a></li><li class=menu-item><a class=menu-item-link href=/categories/>Categories</a></li></ul></nav></header><main id=main class=main><div class=content-wrapper><div id=content class=content><article class=post><header class=post-header><h1 class=post-title>高可用部署cmp相关脚本</h1><div class=post-meta><span class=post-time>0001-01-01</span>
<span class=more-meta>约 3974 字</span>
<span class=more-meta>预计阅读 8 分钟</span></div></header><div class=post-toc id=post-toc><h2 class=post-toc-title>文章目录</h2><div class=post-toc-content><nav id=TableOfContents><ul><li><ul><li><a href=#高可用部署cmp相关脚本>高可用部署cmp相关脚本</a><ul><li><a href=#rightcloud-var-ha>rightcloud_var_ha</a></li><li><a href=#rightcloud-env-ha>rightcloud_env_ha</a></li><li><a href=#数据库初始化>数据库初始化</a></li><li><a href=#注入ip相关的配置>注入ip相关的配置</a></li><li><a href=#db-migration>db migration</a></li><li><a href=#禁用云环境>禁用云环境</a></li><li><a href=#运行>运行</a></li></ul></li></ul></li></ul></nav></div></div><div class=post-outdated><div class=warn><p>【注意】最后更新于 <span class=timeago datetime=0001-01-01T00:00:00 title="January 1, 0001">January 1, 0001</span>，文中内容可能已过时，请谨慎使用。</p></div></div><div class=post-content><div class="ox-hugo-toc toc"><div></div><div class=heading>Table of Contents</div><ul><li><a href=#%E9%AB%98%E5%8F%AF%E7%94%A8%E9%83%A8%E7%BD%B2cmp%E7%9B%B8%E5%85%B3%E8%84%9A%E6%9C%AC>高可用部署cmp相关脚本</a><ul><li><a href=#rightcloud-var-ha>rightcloud_var_ha</a></li><li><a href=#rightcloud-env-ha>rightcloud_env_ha</a></li><li><a href=#%E6%95%B0%E6%8D%AE%E5%BA%93%E5%88%9D%E5%A7%8B%E5%8C%96>数据库初始化</a></li><li><a href=#%E6%B3%A8%E5%85%A5ip%E7%9B%B8%E5%85%B3%E7%9A%84%E9%85%8D%E7%BD%AE>注入ip相关的配置</a></li><li><a href=#db-migration>db migration</a></li><li><a href=#%E7%A6%81%E7%94%A8%E4%BA%91%E7%8E%AF%E5%A2%83>禁用云环境</a></li><li><a href=#%E8%BF%90%E8%A1%8C>运行</a></li></ul></li></ul></div><h2 id=高可用部署cmp相关脚本>高可用部署cmp相关脚本</h2><p>对于基础组件的部署配置，请参考高可用部署相关的文档。这里提供了2个脚本用来处理cmp相关组件的快速部署和升级的。这两个文件都放在 <code>/usr/local/rightcloud/</code> 目录下。</p><h3 id=rightcloud-var-ha>rightcloud_var_ha</h3><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre class=chroma><code><span class=lnt>  1
</span><span class=lnt>  2
</span><span class=lnt>  3
</span><span class=lnt>  4
</span><span class=lnt>  5
</span><span class=lnt>  6
</span><span class=lnt>  7
</span><span class=lnt>  8
</span><span class=lnt>  9
</span><span class=lnt> 10
</span><span class=lnt> 11
</span><span class=lnt> 12
</span><span class=lnt> 13
</span><span class=lnt> 14
</span><span class=lnt> 15
</span><span class=lnt> 16
</span><span class=lnt> 17
</span><span class=lnt> 18
</span><span class=lnt> 19
</span><span class=lnt> 20
</span><span class=lnt> 21
</span><span class=lnt> 22
</span><span class=lnt> 23
</span><span class=lnt> 24
</span><span class=lnt> 25
</span><span class=lnt> 26
</span><span class=lnt> 27
</span><span class=lnt> 28
</span><span class=lnt> 29
</span><span class=lnt> 30
</span><span class=lnt> 31
</span><span class=lnt> 32
</span><span class=lnt> 33
</span><span class=lnt> 34
</span><span class=lnt> 35
</span><span class=lnt> 36
</span><span class=lnt> 37
</span><span class=lnt> 38
</span><span class=lnt> 39
</span><span class=lnt> 40
</span><span class=lnt> 41
</span><span class=lnt> 42
</span><span class=lnt> 43
</span><span class=lnt> 44
</span><span class=lnt> 45
</span><span class=lnt> 46
</span><span class=lnt> 47
</span><span class=lnt> 48
</span><span class=lnt> 49
</span><span class=lnt> 50
</span><span class=lnt> 51
</span><span class=lnt> 52
</span><span class=lnt> 53
</span><span class=lnt> 54
</span><span class=lnt> 55
</span><span class=lnt> 56
</span><span class=lnt> 57
</span><span class=lnt> 58
</span><span class=lnt> 59
</span><span class=lnt> 60
</span><span class=lnt> 61
</span><span class=lnt> 62
</span><span class=lnt> 63
</span><span class=lnt> 64
</span><span class=lnt> 65
</span><span class=lnt> 66
</span><span class=lnt> 67
</span><span class=lnt> 68
</span><span class=lnt> 69
</span><span class=lnt> 70
</span><span class=lnt> 71
</span><span class=lnt> 72
</span><span class=lnt> 73
</span><span class=lnt> 74
</span><span class=lnt> 75
</span><span class=lnt> 76
</span><span class=lnt> 77
</span><span class=lnt> 78
</span><span class=lnt> 79
</span><span class=lnt> 80
</span><span class=lnt> 81
</span><span class=lnt> 82
</span><span class=lnt> 83
</span><span class=lnt> 84
</span><span class=lnt> 85
</span><span class=lnt> 86
</span><span class=lnt> 87
</span><span class=lnt> 88
</span><span class=lnt> 89
</span><span class=lnt> 90
</span><span class=lnt> 91
</span><span class=lnt> 92
</span><span class=lnt> 93
</span><span class=lnt> 94
</span><span class=lnt> 95
</span><span class=lnt> 96
</span><span class=lnt> 97
</span><span class=lnt> 98
</span><span class=lnt> 99
</span><span class=lnt>100
</span><span class=lnt>101
</span><span class=lnt>102
</span><span class=lnt>103
</span><span class=lnt>104
</span><span class=lnt>105
</span></code></pre></td><td class=lntd><pre class=chroma><code class=language-sh data-lang=sh><span class=cp>#!/bin/bash
</span><span class=cp></span>
<span class=nb>export</span> <span class=nv>PATH</span><span class=o>=</span><span class=nv>$PATH</span>:/usr/local/bin
<span class=nv>WORKDIR</span><span class=o>=</span>/usr/local/rightcloud

<span class=c1># HA configration</span>
<span class=nv>VIP</span><span class=o>=</span>10.1.10.87
<span class=nv>REDIS_HA_PORT</span><span class=o>=</span><span class=m>6378</span>
<span class=nv>MYSQL_HA_PORT</span><span class=o>=</span><span class=m>3406</span>
<span class=nv>MQ_HA_PORT</span><span class=o>=</span><span class=m>5772</span>
<span class=nv>MQ_MGT_HA_PORT</span><span class=o>=</span><span class=m>15772</span>
<span class=nv>CONSOLE_HA_PORT</span><span class=o>=</span><span class=m>13380</span>
<span class=nv>SERVER_HA_PORT</span><span class=o>=</span><span class=m>8444</span>
<span class=nv>REPOMIRROR_HA_PORT</span><span class=o>=</span><span class=m>1518</span>
<span class=nv>WEBSSH_HA_PORT</span><span class=o>=</span><span class=m>4833</span>
<span class=nv>FALCON_IP_ADDRESS</span><span class=o>=</span>10.1.10.93
<span class=nv>MONGODB_IP_ADDRESS</span><span class=o>=</span>10.1.10.92
<span class=nv>PUBLIC_IP</span><span class=o>=</span>cmp.gsww.com
<span class=nv>PUBLIC_IP2</span><span class=o>=</span>202.100.86.93
<span class=nv>CONSOLE_HA_PORT2</span><span class=o>=</span><span class=m>13381</span>

<span class=nv>en0</span><span class=o>=</span><span class=s2>&#34;ens32&#34;</span>
<span class=nv>ANYNODE_PREFIX</span><span class=o>=</span>rightcloud
<span class=nv>HOSTIP</span><span class=o>=</span><span class=sb>`</span>ifconfig <span class=si>${</span><span class=nv>en0</span><span class=si>}</span> <span class=p>|</span>grep inet <span class=p>|</span>grep -v inet6 <span class=p>|</span>awk <span class=s1>&#39;{print $2}&#39;</span><span class=sb>`</span>
<span class=nv>INNER_IP</span><span class=o>=</span><span class=sb>`</span>ifconfig <span class=si>${</span><span class=nv>en0</span><span class=si>}</span> <span class=p>|</span>grep inet <span class=p>|</span>grep -v inet6 <span class=p>|</span>awk <span class=s1>&#39;{print $2}&#39;</span><span class=sb>`</span>

<span class=c1># redis related conf</span>
<span class=nv>REDIS_IP</span><span class=o>=</span><span class=si>${</span><span class=nv>VIP</span><span class=si>}</span>
<span class=nv>REDIS_PORT</span><span class=o>=</span><span class=si>${</span><span class=nv>REDIS_HA_PORT</span><span class=si>}</span>
<span class=nv>REDIS_URL</span><span class=o>=</span><span class=si>${</span><span class=nv>REDIS_IP</span><span class=si>}</span>:<span class=si>${</span><span class=nv>REDIS_PORT</span><span class=si>}</span>

<span class=c1># MQ related conf</span>
<span class=nv>RABBIT_MQ_URL</span><span class=o>=</span><span class=si>${</span><span class=nv>VIP</span><span class=si>}</span>
<span class=nv>MQ_URL</span><span class=o>=</span><span class=si>${</span><span class=nv>VIP</span><span class=si>}</span>
<span class=nv>MQ_PORT</span><span class=o>=</span><span class=si>${</span><span class=nv>MQ_HA_PORT</span><span class=si>}</span>
<span class=nv>MQ_MGT_PORT</span><span class=o>=</span><span class=si>${</span><span class=nv>MQ_MGT_PORT</span><span class=si>}</span>
<span class=nv>MQ_USER</span><span class=o>=</span>admin
<span class=nv>MQ_PASS</span><span class=o>=</span><span class=m>1</span>

<span class=c1># repo mirror conf</span>
<span class=nv>REPOMIRROR_URI</span><span class=o>=</span><span class=si>${</span><span class=nv>VIP</span><span class=si>}</span>:<span class=si>${</span><span class=nv>REPOMIRROR_HA_PORT</span><span class=si>}</span>
<span class=nv>REPOMIRROR_PORT</span><span class=o>=</span><span class=m>1517</span>


<span class=c1># webssh conf</span>
<span class=nv>WEB_SSH_PORT</span><span class=o>=</span><span class=m>9999</span>
<span class=nv>GUACD_HOST</span><span class=o>=</span><span class=si>${</span><span class=nv>VIP</span><span class=si>}</span>
<span class=nv>GUACD_PORT</span><span class=o>=</span><span class=si>${</span><span class=nv>WEB_SSH_HA_PORT</span><span class=si>}</span>


<span class=c1># mongodb conf</span>
<span class=nv>MONGODB_HOST</span><span class=o>=</span><span class=si>${</span><span class=nv>MONGODB_IP_ADDRESS</span><span class=si>}</span>
<span class=nv>MONGODB_USERNAME</span><span class=o>=</span>rightcloud
<span class=nv>MONGODB_PASSWORD</span><span class=o>=</span>H89lBgAg
<span class=nv>MONGODB_PORT</span><span class=o>=</span><span class=m>3389</span>

<span class=c1># mysql conf</span>
<span class=nv>MYSQL_PORT</span><span class=o>=</span><span class=m>3306</span>
<span class=nv>DB_URL</span><span class=o>=</span><span class=si>${</span><span class=nv>VIP</span><span class=si>}</span>:<span class=si>${</span><span class=nv>MYSQL_HA_PORT</span><span class=si>}</span>
<span class=nv>DB_USER</span><span class=o>=</span>root
<span class=nv>DB_PASSWORD</span><span class=o>=</span>root-mysql-pw

<span class=c1># monitor conf</span>
<span class=nv>FALCON_IP</span><span class=o>=</span><span class=si>${</span><span class=nv>FALCON_IP_ADDRESS</span><span class=si>}</span>
<span class=nv>FALCON_DB_URL</span><span class=o>=</span><span class=si>${</span><span class=nv>FALCON_IP</span><span class=si>}</span>:3307
<span class=nv>FALCON_DB_PASSWORD</span><span class=o>=</span>

<span class=c1># server conf</span>
<span class=nv>SERVER_PORT</span><span class=o>=</span><span class=m>8809</span>
<span class=nv>SERVER_PORT_H</span><span class=o>=</span><span class=m>8080</span>
<span class=nv>SERVER_REST_PORT</span><span class=o>=</span><span class=si>${</span><span class=nv>SERVER_PORT</span><span class=si>}</span>

<span class=c1># console conf</span>
<span class=nv>CONSOLE_PORT</span><span class=o>=</span><span class=m>8808</span>
<span class=nv>UPSTREAM_SERVER</span><span class=o>=</span><span class=si>${</span><span class=nv>VIP</span><span class=si>}</span>:<span class=si>${</span><span class=nv>SERVER_HA_PORT</span><span class=si>}</span>
<span class=nv>REST_URL</span><span class=o>=</span>http://<span class=si>${</span><span class=nv>PUBLIC_IP</span><span class=si>}</span>
<span class=nv>WEBSOCKET_URL</span><span class=o>=</span>ws://<span class=si>${</span><span class=nv>PUBLIC_IP</span><span class=si>}</span>/api/v1/ws
<span class=nv>WEBSSH_URL</span><span class=o>=</span>http://<span class=si>${</span><span class=nv>PUBLIC_IP</span><span class=si>}</span>:<span class=si>${</span><span class=nv>WEBSSH_HA_PORT</span><span class=si>}</span>
<span class=nv>UPSTREAM_DCIMSERVER</span><span class=o>=</span>127.0.0.1
<span class=nv>DOC_URL</span><span class=o>=</span>http://<span class=si>${</span><span class=nv>PUBLIC_IP</span><span class=si>}</span>/doc/htm/docMain.html
<span class=nv>UPLOAD_URL</span><span class=o>=</span>http://<span class=si>${</span><span class=nv>PUBLIC_IP</span><span class=si>}</span>/user-console/static/files/

<span class=nv>CONSOLE_PORT2</span><span class=o>=</span><span class=m>8108</span>
<span class=nv>REST_URL2</span><span class=o>=</span>http://<span class=si>${</span><span class=nv>PUBLIC_IP2</span><span class=si>}</span>:<span class=si>${</span><span class=nv>CONSOLE_HA_PORT2</span><span class=si>}</span>
<span class=nv>WEBSOCKET_URL2</span><span class=o>=</span>ws://<span class=si>${</span><span class=nv>PUBLIC_IP2</span><span class=si>}</span>:<span class=si>${</span><span class=nv>CONSOLE_HA_PORT2</span><span class=si>}</span>/api/v1/ws
<span class=nv>WEBSSH_URL2</span><span class=o>=</span>http://<span class=si>${</span><span class=nv>PUBLIC_IP2</span><span class=si>}</span>:<span class=si>${</span><span class=nv>WEBSSH_HA_PORT</span><span class=si>}</span>
<span class=nv>DOC_URL2</span><span class=o>=</span>http://<span class=si>${</span><span class=nv>PUBLIC_IP2</span><span class=si>}</span>:<span class=si>${</span><span class=nv>CONSOLE_HA_PORT2</span><span class=si>}</span>/doc/htm/docMain.html


<span class=nv>HOST_IP</span><span class=o>=</span><span class=si>${</span><span class=nv>HOSTIP</span><span class=si>}</span>
<span class=nv>IS_GATEWAY</span><span class=o>=</span>False
<span class=nv>PROTOCOL</span><span class=o>=</span>http
<span class=nv>PLATFORM_TYPE</span><span class=o>=</span>private
<span class=c1>#MONGO_PORT=3389</span>


<span class=nv>WEBSSH_TAG</span><span class=o>=</span>image.rightcloud.com.cn/library/rightcloud-rdp:latest
<span class=nv>REPOMIRROR_TAG</span><span class=o>=</span>image.rightcloud.com.cn/rightcloud/repomirror:v201901151430
<span class=nv>ANSIBLE_TAG</span><span class=o>=</span>image.rightcloud.com.cn/gsww-project/rightcloud-ansible:v.release-201901041846.1
<span class=nv>SERVER_TAG</span><span class=o>=</span>image.rightcloud.com.cn/gsww-project/rightcloud-server:v.gsww-project-201901291522.16
<span class=nv>ADAPTER_TAG</span><span class=o>=</span>image.rightcloud.com.cn/gsww-project/rightcloud-adapter:v.gsww-project-201901111027.3
<span class=nv>CONSOLE_TAG</span><span class=o>=</span>image.rightcloud.com.cn/gsww-project/rightcloud-console:v.feature-vue-201901151140.11
<span class=nv>SCHEDULE_TAG</span><span class=o>=</span>image.rightcloud.com.cn/gsww-project/rightcloud-schedule:v.gsww-project-201901111027.12
<span class=nv>DB_MIGRATION_TAG</span><span class=o>=</span>image.rightcloud.com.cn/gsww-project/rightcloud-db-migration:v.gsww-project-201901141722.13
<span class=nv>MONGO_TAG</span><span class=o>=</span>image.rightcloud.com.cn/library/mongodb:3.7
</code></pre></td></tr></table></div></div><p>这里的修改主要是以下几个：</p><ul><li><code>VIP</code> 最终所使用的VIP</li><li><code>FALCON_IP_ADDRESS</code> monitor所在机器的ip (单点)</li><li><code>MONGODB_IP_ADDRESS</code> mongodb所在机器的ip (单点)</li><li><code>PUBLIC_IP</code> 最终对外的IP，这里可能是VIP，也可能是其他IP（客户有自己做前置代理），新版新版本应该不需要这个了</li><li><code>PUBLIC_IP2</code> 这个是给gsww用的，他们启动了2套前端，用于不同的访问</li><li><code>en0</code> 这个是机器的网卡，用于自动获取IP用的</li></ul><h3 id=rightcloud-env-ha>rightcloud_env_ha</h3><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre class=chroma><code><span class=lnt>  1
</span><span class=lnt>  2
</span><span class=lnt>  3
</span><span class=lnt>  4
</span><span class=lnt>  5
</span><span class=lnt>  6
</span><span class=lnt>  7
</span><span class=lnt>  8
</span><span class=lnt>  9
</span><span class=lnt> 10
</span><span class=lnt> 11
</span><span class=lnt> 12
</span><span class=lnt> 13
</span><span class=lnt> 14
</span><span class=lnt> 15
</span><span class=lnt> 16
</span><span class=lnt> 17
</span><span class=lnt> 18
</span><span class=lnt> 19
</span><span class=lnt> 20
</span><span class=lnt> 21
</span><span class=lnt> 22
</span><span class=lnt> 23
</span><span class=lnt> 24
</span><span class=lnt> 25
</span><span class=lnt> 26
</span><span class=lnt> 27
</span><span class=lnt> 28
</span><span class=lnt> 29
</span><span class=lnt> 30
</span><span class=lnt> 31
</span><span class=lnt> 32
</span><span class=lnt> 33
</span><span class=lnt> 34
</span><span class=lnt> 35
</span><span class=lnt> 36
</span><span class=lnt> 37
</span><span class=lnt> 38
</span><span class=lnt> 39
</span><span class=lnt> 40
</span><span class=lnt> 41
</span><span class=lnt> 42
</span><span class=lnt> 43
</span><span class=lnt> 44
</span><span class=lnt> 45
</span><span class=lnt> 46
</span><span class=lnt> 47
</span><span class=lnt> 48
</span><span class=lnt> 49
</span><span class=lnt> 50
</span><span class=lnt> 51
</span><span class=lnt> 52
</span><span class=lnt> 53
</span><span class=lnt> 54
</span><span class=lnt> 55
</span><span class=lnt> 56
</span><span class=lnt> 57
</span><span class=lnt> 58
</span><span class=lnt> 59
</span><span class=lnt> 60
</span><span class=lnt> 61
</span><span class=lnt> 62
</span><span class=lnt> 63
</span><span class=lnt> 64
</span><span class=lnt> 65
</span><span class=lnt> 66
</span><span class=lnt> 67
</span><span class=lnt> 68
</span><span class=lnt> 69
</span><span class=lnt> 70
</span><span class=lnt> 71
</span><span class=lnt> 72
</span><span class=lnt> 73
</span><span class=lnt> 74
</span><span class=lnt> 75
</span><span class=lnt> 76
</span><span class=lnt> 77
</span><span class=lnt> 78
</span><span class=lnt> 79
</span><span class=lnt> 80
</span><span class=lnt> 81
</span><span class=lnt> 82
</span><span class=lnt> 83
</span><span class=lnt> 84
</span><span class=lnt> 85
</span><span class=lnt> 86
</span><span class=lnt> 87
</span><span class=lnt> 88
</span><span class=lnt> 89
</span><span class=lnt> 90
</span><span class=lnt> 91
</span><span class=lnt> 92
</span><span class=lnt> 93
</span><span class=lnt> 94
</span><span class=lnt> 95
</span><span class=lnt> 96
</span><span class=lnt> 97
</span><span class=lnt> 98
</span><span class=lnt> 99
</span><span class=lnt>100
</span><span class=lnt>101
</span><span class=lnt>102
</span><span class=lnt>103
</span><span class=lnt>104
</span><span class=lnt>105
</span><span class=lnt>106
</span><span class=lnt>107
</span><span class=lnt>108
</span><span class=lnt>109
</span><span class=lnt>110
</span><span class=lnt>111
</span><span class=lnt>112
</span><span class=lnt>113
</span><span class=lnt>114
</span><span class=lnt>115
</span><span class=lnt>116
</span><span class=lnt>117
</span><span class=lnt>118
</span><span class=lnt>119
</span><span class=lnt>120
</span><span class=lnt>121
</span><span class=lnt>122
</span><span class=lnt>123
</span><span class=lnt>124
</span><span class=lnt>125
</span><span class=lnt>126
</span><span class=lnt>127
</span><span class=lnt>128
</span><span class=lnt>129
</span><span class=lnt>130
</span><span class=lnt>131
</span><span class=lnt>132
</span><span class=lnt>133
</span><span class=lnt>134
</span><span class=lnt>135
</span><span class=lnt>136
</span><span class=lnt>137
</span><span class=lnt>138
</span><span class=lnt>139
</span><span class=lnt>140
</span><span class=lnt>141
</span><span class=lnt>142
</span><span class=lnt>143
</span><span class=lnt>144
</span><span class=lnt>145
</span><span class=lnt>146
</span><span class=lnt>147
</span><span class=lnt>148
</span><span class=lnt>149
</span><span class=lnt>150
</span><span class=lnt>151
</span><span class=lnt>152
</span><span class=lnt>153
</span><span class=lnt>154
</span><span class=lnt>155
</span><span class=lnt>156
</span><span class=lnt>157
</span><span class=lnt>158
</span><span class=lnt>159
</span><span class=lnt>160
</span><span class=lnt>161
</span><span class=lnt>162
</span><span class=lnt>163
</span><span class=lnt>164
</span><span class=lnt>165
</span><span class=lnt>166
</span><span class=lnt>167
</span><span class=lnt>168
</span><span class=lnt>169
</span><span class=lnt>170
</span><span class=lnt>171
</span><span class=lnt>172
</span><span class=lnt>173
</span><span class=lnt>174
</span><span class=lnt>175
</span><span class=lnt>176
</span><span class=lnt>177
</span><span class=lnt>178
</span><span class=lnt>179
</span><span class=lnt>180
</span><span class=lnt>181
</span><span class=lnt>182
</span><span class=lnt>183
</span><span class=lnt>184
</span><span class=lnt>185
</span><span class=lnt>186
</span><span class=lnt>187
</span><span class=lnt>188
</span><span class=lnt>189
</span><span class=lnt>190
</span><span class=lnt>191
</span><span class=lnt>192
</span><span class=lnt>193
</span><span class=lnt>194
</span><span class=lnt>195
</span><span class=lnt>196
</span><span class=lnt>197
</span><span class=lnt>198
</span><span class=lnt>199
</span><span class=lnt>200
</span><span class=lnt>201
</span><span class=lnt>202
</span><span class=lnt>203
</span><span class=lnt>204
</span><span class=lnt>205
</span><span class=lnt>206
</span><span class=lnt>207
</span><span class=lnt>208
</span><span class=lnt>209
</span><span class=lnt>210
</span><span class=lnt>211
</span><span class=lnt>212
</span><span class=lnt>213
</span><span class=lnt>214
</span><span class=lnt>215
</span><span class=lnt>216
</span><span class=lnt>217
</span><span class=lnt>218
</span><span class=lnt>219
</span><span class=lnt>220
</span><span class=lnt>221
</span><span class=lnt>222
</span><span class=lnt>223
</span><span class=lnt>224
</span><span class=lnt>225
</span><span class=lnt>226
</span><span class=lnt>227
</span><span class=lnt>228
</span><span class=lnt>229
</span><span class=lnt>230
</span><span class=lnt>231
</span><span class=lnt>232
</span><span class=lnt>233
</span><span class=lnt>234
</span><span class=lnt>235
</span><span class=lnt>236
</span><span class=lnt>237
</span><span class=lnt>238
</span><span class=lnt>239
</span><span class=lnt>240
</span><span class=lnt>241
</span><span class=lnt>242
</span><span class=lnt>243
</span><span class=lnt>244
</span><span class=lnt>245
</span><span class=lnt>246
</span><span class=lnt>247
</span><span class=lnt>248
</span><span class=lnt>249
</span><span class=lnt>250
</span><span class=lnt>251
</span><span class=lnt>252
</span><span class=lnt>253
</span><span class=lnt>254
</span><span class=lnt>255
</span><span class=lnt>256
</span><span class=lnt>257
</span><span class=lnt>258
</span><span class=lnt>259
</span><span class=lnt>260
</span><span class=lnt>261
</span><span class=lnt>262
</span><span class=lnt>263
</span><span class=lnt>264
</span><span class=lnt>265
</span><span class=lnt>266
</span><span class=lnt>267
</span><span class=lnt>268
</span><span class=lnt>269
</span><span class=lnt>270
</span><span class=lnt>271
</span><span class=lnt>272
</span><span class=lnt>273
</span><span class=lnt>274
</span><span class=lnt>275
</span><span class=lnt>276
</span><span class=lnt>277
</span><span class=lnt>278
</span><span class=lnt>279
</span><span class=lnt>280
</span><span class=lnt>281
</span><span class=lnt>282
</span><span class=lnt>283
</span><span class=lnt>284
</span><span class=lnt>285
</span><span class=lnt>286
</span><span class=lnt>287
</span><span class=lnt>288
</span><span class=lnt>289
</span><span class=lnt>290
</span><span class=lnt>291
</span><span class=lnt>292
</span><span class=lnt>293
</span><span class=lnt>294
</span><span class=lnt>295
</span><span class=lnt>296
</span><span class=lnt>297
</span><span class=lnt>298
</span><span class=lnt>299
</span><span class=lnt>300
</span><span class=lnt>301
</span><span class=lnt>302
</span><span class=lnt>303
</span><span class=lnt>304
</span><span class=lnt>305
</span><span class=lnt>306
</span><span class=lnt>307
</span><span class=lnt>308
</span><span class=lnt>309
</span><span class=lnt>310
</span><span class=lnt>311
</span><span class=lnt>312
</span><span class=lnt>313
</span><span class=lnt>314
</span><span class=lnt>315
</span><span class=lnt>316
</span><span class=lnt>317
</span><span class=lnt>318
</span><span class=lnt>319
</span><span class=lnt>320
</span><span class=lnt>321
</span><span class=lnt>322
</span><span class=lnt>323
</span><span class=lnt>324
</span><span class=lnt>325
</span><span class=lnt>326
</span><span class=lnt>327
</span><span class=lnt>328
</span><span class=lnt>329
</span><span class=lnt>330
</span><span class=lnt>331
</span><span class=lnt>332
</span><span class=lnt>333
</span><span class=lnt>334
</span><span class=lnt>335
</span><span class=lnt>336
</span><span class=lnt>337
</span><span class=lnt>338
</span><span class=lnt>339
</span><span class=lnt>340
</span><span class=lnt>341
</span><span class=lnt>342
</span><span class=lnt>343
</span><span class=lnt>344
</span><span class=lnt>345
</span><span class=lnt>346
</span><span class=lnt>347
</span><span class=lnt>348
</span><span class=lnt>349
</span><span class=lnt>350
</span><span class=lnt>351
</span><span class=lnt>352
</span><span class=lnt>353
</span><span class=lnt>354
</span><span class=lnt>355
</span><span class=lnt>356
</span><span class=lnt>357
</span><span class=lnt>358
</span><span class=lnt>359
</span><span class=lnt>360
</span><span class=lnt>361
</span><span class=lnt>362
</span><span class=lnt>363
</span><span class=lnt>364
</span><span class=lnt>365
</span><span class=lnt>366
</span><span class=lnt>367
</span><span class=lnt>368
</span><span class=lnt>369
</span><span class=lnt>370
</span><span class=lnt>371
</span><span class=lnt>372
</span><span class=lnt>373
</span><span class=lnt>374
</span><span class=lnt>375
</span><span class=lnt>376
</span><span class=lnt>377
</span><span class=lnt>378
</span><span class=lnt>379
</span><span class=lnt>380
</span><span class=lnt>381
</span><span class=lnt>382
</span><span class=lnt>383
</span><span class=lnt>384
</span><span class=lnt>385
</span><span class=lnt>386
</span><span class=lnt>387
</span><span class=lnt>388
</span><span class=lnt>389
</span><span class=lnt>390
</span><span class=lnt>391
</span><span class=lnt>392
</span><span class=lnt>393
</span><span class=lnt>394
</span><span class=lnt>395
</span><span class=lnt>396
</span><span class=lnt>397
</span><span class=lnt>398
</span><span class=lnt>399
</span><span class=lnt>400
</span><span class=lnt>401
</span><span class=lnt>402
</span><span class=lnt>403
</span><span class=lnt>404
</span><span class=lnt>405
</span><span class=lnt>406
</span><span class=lnt>407
</span><span class=lnt>408
</span><span class=lnt>409
</span><span class=lnt>410
</span><span class=lnt>411
</span><span class=lnt>412
</span><span class=lnt>413
</span><span class=lnt>414
</span><span class=lnt>415
</span><span class=lnt>416
</span><span class=lnt>417
</span><span class=lnt>418
</span><span class=lnt>419
</span><span class=lnt>420
</span><span class=lnt>421
</span><span class=lnt>422
</span><span class=lnt>423
</span><span class=lnt>424
</span><span class=lnt>425
</span><span class=lnt>426
</span><span class=lnt>427
</span><span class=lnt>428
</span><span class=lnt>429
</span><span class=lnt>430
</span><span class=lnt>431
</span><span class=lnt>432
</span><span class=lnt>433
</span><span class=lnt>434
</span><span class=lnt>435
</span><span class=lnt>436
</span><span class=lnt>437
</span><span class=lnt>438
</span><span class=lnt>439
</span><span class=lnt>440
</span><span class=lnt>441
</span><span class=lnt>442
</span><span class=lnt>443
</span><span class=lnt>444
</span><span class=lnt>445
</span><span class=lnt>446
</span><span class=lnt>447
</span><span class=lnt>448
</span><span class=lnt>449
</span><span class=lnt>450
</span><span class=lnt>451
</span><span class=lnt>452
</span><span class=lnt>453
</span><span class=lnt>454
</span><span class=lnt>455
</span><span class=lnt>456
</span><span class=lnt>457
</span><span class=lnt>458
</span><span class=lnt>459
</span><span class=lnt>460
</span><span class=lnt>461
</span><span class=lnt>462
</span><span class=lnt>463
</span><span class=lnt>464
</span><span class=lnt>465
</span><span class=lnt>466
</span><span class=lnt>467
</span><span class=lnt>468
</span><span class=lnt>469
</span><span class=lnt>470
</span><span class=lnt>471
</span><span class=lnt>472
</span><span class=lnt>473
</span><span class=lnt>474
</span><span class=lnt>475
</span><span class=lnt>476
</span><span class=lnt>477
</span><span class=lnt>478
</span><span class=lnt>479
</span><span class=lnt>480
</span><span class=lnt>481
</span><span class=lnt>482
</span><span class=lnt>483
</span><span class=lnt>484
</span><span class=lnt>485
</span><span class=lnt>486
</span><span class=lnt>487
</span><span class=lnt>488
</span><span class=lnt>489
</span><span class=lnt>490
</span><span class=lnt>491
</span><span class=lnt>492
</span><span class=lnt>493
</span><span class=lnt>494
</span><span class=lnt>495
</span><span class=lnt>496
</span><span class=lnt>497
</span><span class=lnt>498
</span><span class=lnt>499
</span><span class=lnt>500
</span><span class=lnt>501
</span><span class=lnt>502
</span><span class=lnt>503
</span><span class=lnt>504
</span><span class=lnt>505
</span><span class=lnt>506
</span><span class=lnt>507
</span><span class=lnt>508
</span><span class=lnt>509
</span><span class=lnt>510
</span><span class=lnt>511
</span><span class=lnt>512
</span><span class=lnt>513
</span><span class=lnt>514
</span><span class=lnt>515
</span><span class=lnt>516
</span><span class=lnt>517
</span><span class=lnt>518
</span><span class=lnt>519
</span><span class=lnt>520
</span><span class=lnt>521
</span><span class=lnt>522
</span><span class=lnt>523
</span><span class=lnt>524
</span><span class=lnt>525
</span><span class=lnt>526
</span><span class=lnt>527
</span><span class=lnt>528
</span><span class=lnt>529
</span><span class=lnt>530
</span><span class=lnt>531
</span><span class=lnt>532
</span><span class=lnt>533
</span><span class=lnt>534
</span><span class=lnt>535
</span><span class=lnt>536
</span><span class=lnt>537
</span><span class=lnt>538
</span><span class=lnt>539
</span><span class=lnt>540
</span><span class=lnt>541
</span><span class=lnt>542
</span><span class=lnt>543
</span><span class=lnt>544
</span><span class=lnt>545
</span><span class=lnt>546
</span><span class=lnt>547
</span><span class=lnt>548
</span><span class=lnt>549
</span><span class=lnt>550
</span><span class=lnt>551
</span><span class=lnt>552
</span><span class=lnt>553
</span><span class=lnt>554
</span><span class=lnt>555
</span><span class=lnt>556
</span><span class=lnt>557
</span><span class=lnt>558
</span><span class=lnt>559
</span><span class=lnt>560
</span><span class=lnt>561
</span><span class=lnt>562
</span><span class=lnt>563
</span><span class=lnt>564
</span><span class=lnt>565
</span><span class=lnt>566
</span><span class=lnt>567
</span><span class=lnt>568
</span><span class=lnt>569
</span><span class=lnt>570
</span><span class=lnt>571
</span><span class=lnt>572
</span><span class=lnt>573
</span><span class=lnt>574
</span><span class=lnt>575
</span><span class=lnt>576
</span><span class=lnt>577
</span><span class=lnt>578
</span><span class=lnt>579
</span><span class=lnt>580
</span><span class=lnt>581
</span><span class=lnt>582
</span><span class=lnt>583
</span><span class=lnt>584
</span><span class=lnt>585
</span><span class=lnt>586
</span><span class=lnt>587
</span><span class=lnt>588
</span><span class=lnt>589
</span><span class=lnt>590
</span><span class=lnt>591
</span><span class=lnt>592
</span><span class=lnt>593
</span><span class=lnt>594
</span><span class=lnt>595
</span><span class=lnt>596
</span><span class=lnt>597
</span><span class=lnt>598
</span><span class=lnt>599
</span><span class=lnt>600
</span><span class=lnt>601
</span><span class=lnt>602
</span><span class=lnt>603
</span><span class=lnt>604
</span><span class=lnt>605
</span><span class=lnt>606
</span><span class=lnt>607
</span><span class=lnt>608
</span><span class=lnt>609
</span><span class=lnt>610
</span><span class=lnt>611
</span><span class=lnt>612
</span><span class=lnt>613
</span><span class=lnt>614
</span><span class=lnt>615
</span><span class=lnt>616
</span><span class=lnt>617
</span><span class=lnt>618
</span><span class=lnt>619
</span><span class=lnt>620
</span><span class=lnt>621
</span><span class=lnt>622
</span><span class=lnt>623
</span><span class=lnt>624
</span><span class=lnt>625
</span><span class=lnt>626
</span><span class=lnt>627
</span><span class=lnt>628
</span><span class=lnt>629
</span><span class=lnt>630
</span><span class=lnt>631
</span><span class=lnt>632
</span><span class=lnt>633
</span><span class=lnt>634
</span><span class=lnt>635
</span><span class=lnt>636
</span><span class=lnt>637
</span><span class=lnt>638
</span><span class=lnt>639
</span><span class=lnt>640
</span><span class=lnt>641
</span><span class=lnt>642
</span><span class=lnt>643
</span><span class=lnt>644
</span><span class=lnt>645
</span><span class=lnt>646
</span><span class=lnt>647
</span><span class=lnt>648
</span><span class=lnt>649
</span><span class=lnt>650
</span><span class=lnt>651
</span><span class=lnt>652
</span><span class=lnt>653
</span><span class=lnt>654
</span><span class=lnt>655
</span><span class=lnt>656
</span><span class=lnt>657
</span><span class=lnt>658
</span><span class=lnt>659
</span><span class=lnt>660
</span><span class=lnt>661
</span><span class=lnt>662
</span><span class=lnt>663
</span><span class=lnt>664
</span><span class=lnt>665
</span><span class=lnt>666
</span><span class=lnt>667
</span><span class=lnt>668
</span><span class=lnt>669
</span><span class=lnt>670
</span><span class=lnt>671
</span><span class=lnt>672
</span><span class=lnt>673
</span><span class=lnt>674
</span><span class=lnt>675
</span><span class=lnt>676
</span><span class=lnt>677
</span><span class=lnt>678
</span><span class=lnt>679
</span><span class=lnt>680
</span><span class=lnt>681
</span><span class=lnt>682
</span><span class=lnt>683
</span><span class=lnt>684
</span><span class=lnt>685
</span><span class=lnt>686
</span><span class=lnt>687
</span><span class=lnt>688
</span><span class=lnt>689
</span><span class=lnt>690
</span><span class=lnt>691
</span><span class=lnt>692
</span><span class=lnt>693
</span><span class=lnt>694
</span><span class=lnt>695
</span><span class=lnt>696
</span><span class=lnt>697
</span><span class=lnt>698
</span><span class=lnt>699
</span><span class=lnt>700
</span><span class=lnt>701
</span><span class=lnt>702
</span><span class=lnt>703
</span><span class=lnt>704
</span><span class=lnt>705
</span><span class=lnt>706
</span><span class=lnt>707
</span><span class=lnt>708
</span><span class=lnt>709
</span><span class=lnt>710
</span><span class=lnt>711
</span><span class=lnt>712
</span><span class=lnt>713
</span><span class=lnt>714
</span><span class=lnt>715
</span><span class=lnt>716
</span><span class=lnt>717
</span><span class=lnt>718
</span><span class=lnt>719
</span><span class=lnt>720
</span><span class=lnt>721
</span><span class=lnt>722
</span><span class=lnt>723
</span><span class=lnt>724
</span><span class=lnt>725
</span><span class=lnt>726
</span><span class=lnt>727
</span><span class=lnt>728
</span><span class=lnt>729
</span><span class=lnt>730
</span><span class=lnt>731
</span><span class=lnt>732
</span><span class=lnt>733
</span><span class=lnt>734
</span><span class=lnt>735
</span><span class=lnt>736
</span><span class=lnt>737
</span><span class=lnt>738
</span><span class=lnt>739
</span><span class=lnt>740
</span><span class=lnt>741
</span><span class=lnt>742
</span><span class=lnt>743
</span><span class=lnt>744
</span><span class=lnt>745
</span><span class=lnt>746
</span><span class=lnt>747
</span><span class=lnt>748
</span><span class=lnt>749
</span><span class=lnt>750
</span><span class=lnt>751
</span><span class=lnt>752
</span><span class=lnt>753
</span><span class=lnt>754
</span><span class=lnt>755
</span><span class=lnt>756
</span><span class=lnt>757
</span><span class=lnt>758
</span><span class=lnt>759
</span><span class=lnt>760
</span><span class=lnt>761
</span><span class=lnt>762
</span><span class=lnt>763
</span><span class=lnt>764
</span><span class=lnt>765
</span><span class=lnt>766
</span><span class=lnt>767
</span><span class=lnt>768
</span><span class=lnt>769
</span><span class=lnt>770
</span><span class=lnt>771
</span><span class=lnt>772
</span><span class=lnt>773
</span><span class=lnt>774
</span><span class=lnt>775
</span><span class=lnt>776
</span><span class=lnt>777
</span><span class=lnt>778
</span><span class=lnt>779
</span><span class=lnt>780
</span><span class=lnt>781
</span><span class=lnt>782
</span><span class=lnt>783
</span><span class=lnt>784
</span><span class=lnt>785
</span><span class=lnt>786
</span><span class=lnt>787
</span><span class=lnt>788
</span><span class=lnt>789
</span><span class=lnt>790
</span><span class=lnt>791
</span><span class=lnt>792
</span><span class=lnt>793
</span><span class=lnt>794
</span><span class=lnt>795
</span><span class=lnt>796
</span><span class=lnt>797
</span><span class=lnt>798
</span><span class=lnt>799
</span><span class=lnt>800
</span><span class=lnt>801
</span><span class=lnt>802
</span><span class=lnt>803
</span><span class=lnt>804
</span><span class=lnt>805
</span><span class=lnt>806
</span><span class=lnt>807
</span><span class=lnt>808
</span><span class=lnt>809
</span><span class=lnt>810
</span><span class=lnt>811
</span><span class=lnt>812
</span><span class=lnt>813
</span><span class=lnt>814
</span></code></pre></td><td class=lntd><pre class=chroma><code class=language-sh data-lang=sh><span class=cp>#!/bin/bash
</span><span class=cp></span>
<span class=nv>RED</span><span class=o>=</span><span class=s2>&#34;\033[0;31m&#34;</span>
<span class=nv>YELLOW</span><span class=o>=</span><span class=s2>&#34;\033[1;33m&#34;</span>
<span class=nv>GREEN</span><span class=o>=</span><span class=s2>&#34;\033[0;32m&#34;</span>
<span class=nv>BLUE</span><span class=o>=</span><span class=s2>&#34;\033[1;34m&#34;</span>
<span class=nv>LIGHT_RED</span><span class=o>=</span><span class=s2>&#34;\033[1;31m&#34;</span>
<span class=nv>LIGHT_GREEN</span><span class=o>=</span><span class=s2>&#34;\033[1;32m&#34;</span>
<span class=nv>CYAN</span><span class=o>=</span><span class=s2>&#34;\033[0;36m&#34;</span>
<span class=nv>LIGHT_CYAN</span><span class=o>=</span><span class=s2>&#34;\033[1;36m&#34;</span>
<span class=nv>WHITE</span><span class=o>=</span><span class=s2>&#34;\033[1;37m&#34;</span>
<span class=nv>LIGHT_GRAY</span><span class=o>=</span><span class=s2>&#34;\033[0;37m&#34;</span>
<span class=nv>COLOR_NONE</span><span class=o>=</span><span class=s2>&#34;\e[0m&#34;</span>
<span class=nv>DOCKER_LOG_OPTS</span><span class=o>=</span><span class=s2>&#34;--restart=always --log-driver json-file --log-opt max-size=500m --log-opt max-file=3 &#34;</span>

<span class=nv>PLATFORM</span><span class=o>=</span><span class=sb>`</span>uname -s<span class=sb>`</span>

<span class=k>if</span> <span class=o>[</span> <span class=sb>`</span>uname<span class=sb>`</span> <span class=o>=</span> <span class=s1>&#39;Darwin&#39;</span> <span class=o>]</span><span class=p>;</span> <span class=k>then</span>
    <span class=nb>alias</span> <span class=nv>sed</span><span class=o>=</span><span class=s1>&#39;/usr/local/bin/gsed&#39;</span>
    <span class=nb>alias</span> <span class=nv>awk</span><span class=o>=</span><span class=s1>&#39;/usr/local/bin/gawk&#39;</span>
<span class=k>fi</span>

color_echo<span class=o>()</span> <span class=o>{</span>
    <span class=k>case</span> <span class=s2>&#34;</span><span class=nv>$TERM</span><span class=s2>&#34;</span> in
        xterm*<span class=o>)</span> <span class=nb>printf</span> <span class=s2>&#34;</span><span class=nv>$*</span><span class=s2> </span><span class=si>${</span><span class=nv>COLOR_NONE</span><span class=si>}</span><span class=s2>\n&#34;</span>
                <span class=p>;;</span>
        *<span class=o>)</span> shift<span class=p>;</span> <span class=nb>printf</span> <span class=s2>&#34;</span><span class=nv>$*</span><span class=s2>\n&#34;</span>
           <span class=p>;;</span>
    <span class=k>esac</span>
<span class=o>}</span>

color_echo_no_newline <span class=o>()</span> <span class=o>{</span>
    <span class=k>case</span> <span class=s2>&#34;</span><span class=nv>$TERM</span><span class=s2>&#34;</span> in
        xterm*<span class=o>)</span> <span class=nb>printf</span> <span class=s2>&#34;</span><span class=nv>$*</span><span class=s2> </span><span class=si>${</span><span class=nv>COLOR_NONE</span><span class=si>}</span><span class=s2>&#34;</span>
                <span class=p>;;</span>
        *<span class=o>)</span> shift<span class=p>;</span> <span class=nb>printf</span> <span class=s2>&#34;</span><span class=nv>$*</span><span class=s2>&#34;</span>
           <span class=p>;;</span>
    <span class=k>esac</span>
<span class=o>}</span>

error<span class=o>()</span> <span class=o>{</span>
    color_echo <span class=si>${</span><span class=nv>LIGHT_RED</span><span class=si>}</span> <span class=nv>$@</span>
<span class=o>}</span>

warning<span class=o>()</span> <span class=o>{</span>
    color_echo <span class=si>${</span><span class=nv>YELLOW</span><span class=si>}</span> <span class=nv>$@</span>
<span class=o>}</span>

logcommand<span class=o>()</span> <span class=o>{</span>
    color_echo_no_newline <span class=si>${</span><span class=nv>LIGHT_RED</span><span class=si>}</span> <span class=s2>&#34;</span>$<span class=s2> &#34;</span>
    color_echo <span class=si>${</span><span class=nv>GREEN</span><span class=si>}</span> <span class=nv>$@</span>
<span class=o>}</span>


info<span class=o>()</span> <span class=o>{</span>
    color_echo <span class=si>${</span><span class=nv>LIGHT_GREEN</span><span class=si>}</span> <span class=nv>$@</span>
<span class=o>}</span>


<span class=nv>WORKDIR</span><span class=o>=</span>/usr/local/rightcloud
. <span class=si>${</span><span class=nv>WORKDIR</span><span class=si>}</span>/rightcloud_var_ha
mkdir -p /usr/local/rightcloud/files/

<span class=k>function</span> valid_ip<span class=o>()</span> <span class=o>{</span>
    <span class=nb>local</span>  <span class=nv>ip</span><span class=o>=</span><span class=nv>$1</span>
    <span class=nb>local</span>  <span class=nv>stat</span><span class=o>=</span><span class=m>1</span>

    <span class=k>if</span> <span class=o>[[</span> <span class=nv>$ip</span> <span class=o>=</span>~ ^<span class=o>[</span>0-9<span class=o>]{</span>1,3<span class=o>}</span><span class=se>\.</span><span class=o>[</span>0-9<span class=o>]{</span>1,3<span class=o>}</span><span class=se>\.</span><span class=o>[</span>0-9<span class=o>]{</span>1,3<span class=o>}</span><span class=se>\.</span><span class=o>[</span>0-9<span class=o>]{</span>1,3<span class=o>}</span>$ <span class=o>]]</span><span class=p>;</span> <span class=k>then</span>
        <span class=nv>OIFS</span><span class=o>=</span><span class=nv>$IFS</span>
        <span class=nv>IFS</span><span class=o>=</span><span class=s1>&#39;.&#39;</span>
        <span class=nv>ip</span><span class=o>=(</span><span class=nv>$ip</span><span class=o>)</span>
        <span class=nv>IFS</span><span class=o>=</span><span class=nv>$OIFS</span>
        <span class=o>[[</span> <span class=si>${</span><span class=nv>ip</span><span class=p>[0]</span><span class=si>}</span> -le <span class=m>255</span> <span class=o>&amp;&amp;</span> <span class=si>${</span><span class=nv>ip</span><span class=p>[1]</span><span class=si>}</span> -le <span class=m>255</span> <span class=se>\
</span><span class=se></span>               <span class=o>&amp;&amp;</span> <span class=si>${</span><span class=nv>ip</span><span class=p>[2]</span><span class=si>}</span> -le <span class=m>255</span> <span class=o>&amp;&amp;</span> <span class=si>${</span><span class=nv>ip</span><span class=p>[3]</span><span class=si>}</span> -le <span class=m>255</span> <span class=o>]]</span>
        <span class=nv>stat</span><span class=o>=</span><span class=nv>$?</span>
    <span class=k>fi</span>
    <span class=k>return</span> <span class=nv>$stat</span>
<span class=o>}</span>

<span class=k>function</span> prompt_input_ip<span class=o>()</span> <span class=o>{</span>
    <span class=k>while</span> /bin/true<span class=p>;</span> <span class=k>do</span>
        <span class=nb>read</span> -p <span class=s2>&#34;Please enter IP address: &#34;</span> -e IP

        valid_ip <span class=s2>&#34;</span><span class=si>${</span><span class=nv>IP</span><span class=si>}</span><span class=s2>&#34;</span>
        <span class=k>if</span> <span class=o>[</span> <span class=nv>$?</span> -eq <span class=m>0</span> <span class=o>]</span><span class=p>;</span> <span class=k>then</span>
            break<span class=p>;</span>
        <span class=k>else</span>
            error <span class=s2>&#34;IP address is invalid, please try again&#34;</span>
        <span class=k>fi</span>
    <span class=k>done</span>

    sed -i <span class=s2>&#34;s/HOSTIP=.*/HOSTIP=</span><span class=si>${</span><span class=nv>IP</span><span class=si>}</span><span class=s2>/g&#34;</span> <span class=si>${</span><span class=nv>WORKDIR</span><span class=si>}</span>/rightcloud_var_ha
<span class=o>}</span>

<span class=k>function</span> check_container <span class=o>()</span>
<span class=o>{</span>
    <span class=nb>echo</span> <span class=s2>&#34;checking container: </span><span class=nv>$1</span><span class=s2>&#34;</span>
    <span class=nv>EXISTS</span><span class=o>=</span><span class=sb>`</span>docker ps -a <span class=p>|</span>awk <span class=s1>&#39;{print $NF}&#39;</span> <span class=p>|</span>grep <span class=s2>&#34;</span><span class=nv>$1</span><span class=s2>&#34;</span> <span class=p>|</span>wc -l<span class=sb>`</span>
    <span class=k>if</span> <span class=o>[</span> <span class=nv>$EXISTS</span> !<span class=o>=</span> <span class=m>0</span> <span class=o>]</span><span class=p>;</span> <span class=k>then</span>
        <span class=nb>echo</span> -e <span class=s2>&#34;\033[36m[INFO] Remove </span><span class=nv>$1</span><span class=s2>...\033[0m&#34;</span>
        docker rm -f <span class=nv>$1</span> <span class=p>&amp;</span>&gt; /dev/null
        <span class=nb>echo</span> -e <span class=s2>&#34;\033[36m[INFO] Remove </span><span class=nv>$1</span><span class=s2> success.\033[0m&#34;</span>
        <span class=k>return</span> 1<span class=p>;</span>
     <span class=k>else</span>
        <span class=k>return</span> 1<span class=p>;</span>
     <span class=k>fi</span>
<span class=o>}</span>

<span class=k>function</span> run_ansible<span class=o>()</span> <span class=o>{</span>
    check_container <span class=s2>&#34;</span><span class=si>${</span><span class=nv>ANYNODE_PREFIX</span><span class=si>}</span><span class=s2>_ansible&#34;</span>
    <span class=k>if</span> <span class=o>[</span> <span class=nv>$?</span> <span class=o>=</span> <span class=m>1</span> <span class=o>]</span><span class=p>;</span> <span class=k>then</span>
        <span class=nb>echo</span> -e <span class=s2>&#34;\033[36m[INFO] Ansible server starting...... \033[0m&#34;</span>
        docker run -d <span class=si>${</span><span class=nv>DOCKER_LOG_OPTS</span><span class=si>}</span> -e <span class=s2>&#34;IS_GATEWAY=</span><span class=nv>$IS_GATEWAY</span><span class=s2>&#34;</span> <span class=se>\
</span><span class=se></span>               -e <span class=s2>&#34;MQ_URL=</span><span class=nv>$MQ_URL</span><span class=s2>&#34;</span> <span class=se>\
</span><span class=se></span>               -e <span class=s2>&#34;MQ_PORT=</span><span class=nv>$MQ_PORT</span><span class=s2>&#34;</span> <span class=se>\
</span><span class=se></span>               -e <span class=s2>&#34;MQ_USER=</span><span class=nv>$MQ_USER</span><span class=s2>&#34;</span> <span class=se>\
</span><span class=se></span>               -e <span class=s2>&#34;MQ_PASS=</span><span class=nv>$MQ_PASS</span><span class=s2>&#34;</span> <span class=se>\
</span><span class=se></span>               -e <span class=s2>&#34;REDIS_IP=</span><span class=nv>$REDIS_IP</span><span class=s2>&#34;</span> <span class=se>\
</span><span class=se></span>               -e <span class=s2>&#34;REDIS_PORT=</span><span class=nv>$REDIS_PORT</span><span class=s2>&#34;</span> <span class=se>\
</span><span class=se></span>               -e <span class=s2>&#34;USE_REPO_MIRROR=true&#34;</span> <span class=se>\
</span><span class=se></span>               -e <span class=s2>&#34;REPOMIRROR_URI=</span><span class=nv>$REPOMIRROR_URI</span><span class=s2>&#34;</span> <span class=se>\
</span><span class=se></span>               -e <span class=s2>&#34;KEEP_ORG_REPO=true&#34;</span> <span class=se>\
</span><span class=se></span>               -v /etc/localtime:/etc/localtime <span class=se>\
</span><span class=se></span>               --name <span class=si>${</span><span class=nv>ANYNODE_PREFIX</span><span class=si>}</span>_ansible <span class=si>${</span><span class=nv>ANSIBLE_TAG</span><span class=si>}</span>

        <span class=k>if</span> <span class=o>[</span> <span class=nv>$?</span> -ne <span class=m>0</span> <span class=o>]</span><span class=p>;</span> <span class=k>then</span>
            <span class=nb>echo</span> -e <span class=s2>&#34;\033[31m[ERROR] Ansible server start failed!\033[0m&#34;</span><span class=p>;</span>
            <span class=k>return</span> 1<span class=p>;</span>
        <span class=k>fi</span>

        <span class=k>for</span> iii in <span class=o>{</span>600..0<span class=o>}</span><span class=p>;</span> <span class=k>do</span>
            <span class=k>if</span> docker <span class=nb>exec</span> -i <span class=si>${</span><span class=nv>ANYNODE_PREFIX</span><span class=si>}</span>_ansible ls / <span class=p>&amp;</span>&gt; /dev/null<span class=p>;</span> <span class=k>then</span>
                <span class=nb>echo</span> <span class=s2>&#34;rightcloud_ansible is ready&#34;</span>
                <span class=nb>break</span>
            <span class=k>fi</span>
            <span class=nb>echo</span> <span class=s1>&#39;rightcloud_ansible init process in progress...&#39;</span>
            sleep <span class=m>1</span>
        <span class=k>done</span>

        <span class=k>if</span> <span class=o>[</span> <span class=s2>&#34;</span><span class=nv>$iii</span><span class=s2>&#34;</span> <span class=o>=</span> <span class=m>0</span> <span class=o>]</span><span class=p>;</span> <span class=k>then</span>
            <span class=nb>echo</span> &gt;<span class=p>&amp;</span><span class=m>2</span> <span class=s1>&#39;rightcloud_ansible init process failed.&#39;</span>
            <span class=k>return</span> <span class=m>1</span>
        <span class=k>fi</span>

        <span class=c1># sleep 20</span>

        <span class=c1>#docker cp ${WORKDIR}/docker_install.sh rightcloud_ansible:/root/ansible_work/files/</span>

        <span class=c1># docker exec ${ANYNODE_PREFIX}_ansible mkdir -p /root/ansible_work/files/jdk/</span>
        <span class=c1># docker exec ${ANYNODE_PREFIX}_ansible mkdir -p /root/ansible_work/files/weblogic/</span>
        <span class=c1># docker cp ${WORKDIR}/ansible_lib/jdk/* ${ANYNODE_PREFIX}_ansible:/root/ansible_work/files/jdk/</span>
        <span class=c1># docker cp ${WORKDIR}/ansible_lib/weblogic/* ${ANYNODE_PREFIX}_ansible:/root/ansible_work/files/weblogic/</span>
    <span class=k>fi</span>
 <span class=o>}</span>

<span class=k>function</span> run_repomirror<span class=o>()</span> <span class=o>{</span>
    check_container <span class=si>${</span><span class=nv>ANYNODE_PREFIX</span><span class=si>}</span>_repomirror
    <span class=k>if</span> <span class=o>[</span> <span class=nv>$?</span> -ne <span class=m>0</span> <span class=o>]</span><span class=p>;</span> <span class=k>then</span>
        <span class=nb>echo</span> -e <span class=s2>&#34;\033[36m[INFO] Repo Mirror starting...... \033[0m&#34;</span>
        docker run -d <span class=si>${</span><span class=nv>DOCKER_LOG_OPTS</span><span class=si>}</span> -p <span class=si>${</span><span class=nv>REPOMIRROR_PORT</span><span class=si>}</span>:80 <span class=se>\
</span><span class=se></span>               --name <span class=si>${</span><span class=nv>ANYNODE_PREFIX</span><span class=si>}</span>_repomirror <span class=si>${</span><span class=nv>REPOMIRROR_TAG</span><span class=si>}</span>
        <span class=k>if</span> <span class=o>[</span> <span class=nv>$?</span> -ne <span class=m>0</span> <span class=o>]</span><span class=p>;</span> <span class=k>then</span>
            <span class=nb>echo</span> -e <span class=s2>&#34;\033[31m[ERROR] Webssh start failed!\033[0m&#34;</span><span class=p>;</span>
            <span class=k>return</span> 1<span class=p>;</span>
        <span class=k>fi</span>
        sleep <span class=m>3</span>
    <span class=k>fi</span>
<span class=o>}</span>


<span class=k>function</span> run_webssh3<span class=o>()</span> <span class=o>{</span>
    check_container <span class=si>${</span><span class=nv>ANYNODE_PREFIX</span><span class=si>}</span>_webssh3
    <span class=k>if</span> <span class=o>[</span> <span class=nv>$?</span> -ne <span class=m>0</span> <span class=o>]</span><span class=p>;</span> <span class=k>then</span>
       <span class=nb>echo</span> -e <span class=s2>&#34;\033[36m[INFO] Webssh starting...... \033[0m&#34;</span>
       docker run -d <span class=si>${</span><span class=nv>DOCKER_LOG_OPTS</span><span class=si>}</span> <span class=se>\
</span><span class=se></span>              -p <span class=si>${</span><span class=nv>WEB_SSH_PORT</span><span class=si>}</span>:4822 <span class=se>\
</span><span class=se></span>              --name <span class=si>${</span><span class=nv>ANYNODE_PREFIX</span><span class=si>}</span>_webssh3 <span class=se>\
</span><span class=se></span>              <span class=si>${</span><span class=nv>WEBSSH_TAG</span><span class=si>}</span>
       <span class=k>if</span> <span class=o>[</span> <span class=nv>$?</span> -ne <span class=m>0</span> <span class=o>]</span><span class=p>;</span> <span class=k>then</span>
           <span class=nb>echo</span> -e <span class=s2>&#34;\033[31m[ERROR] Webssh start failed!\033[0m&#34;</span><span class=p>;</span>
           <span class=k>return</span> 1<span class=p>;</span>
       <span class=k>fi</span>
       sleep <span class=m>3</span>
    <span class=k>fi</span>
<span class=o>}</span>

<span class=k>function</span> run_mongo<span class=o>()</span> <span class=o>{</span>
    check_container <span class=si>${</span><span class=nv>ANYNODE_PREFIX</span><span class=si>}</span>_mongo
    <span class=k>if</span> <span class=o>[</span> <span class=nv>$?</span> -ne <span class=m>0</span> <span class=o>]</span><span class=p>;</span> <span class=k>then</span>
        <span class=nb>echo</span> -e <span class=s2>&#34;\033[36m[INFO] Mongo starting...... \033[0m&#34;</span>
        docker run -d <span class=si>${</span><span class=nv>DOCKER_LOG_OPTS</span><span class=si>}</span> -p <span class=si>${</span><span class=nv>MONGODB_PORT</span><span class=si>}</span>:27017 -v <span class=si>${</span><span class=nv>WORKDIR</span><span class=si>}</span>/mongo/data/mongodb:/bitnami <span class=se>\
</span><span class=se></span>        -e <span class=nv>MONGODB_DATABASE</span><span class=o>=</span>rightcloud <span class=se>\
</span><span class=se></span>        -e <span class=nv>MONGODB_USERNAME</span><span class=o>=</span><span class=si>${</span><span class=nv>MONGODB_USERNAME</span><span class=si>}</span> -e <span class=nv>MONGODB_PASSWORD</span><span class=o>=</span><span class=si>${</span><span class=nv>MONGODB_PASSWORD</span><span class=si>}</span> <span class=se>\
</span><span class=se></span>        --name <span class=si>${</span><span class=nv>ANYNODE_PREFIX</span><span class=si>}</span>_mongo <span class=si>${</span><span class=nv>MONGO_TAG</span><span class=si>}</span>
        <span class=k>if</span> <span class=o>[</span> <span class=nv>$?</span> -ne <span class=m>0</span> <span class=o>]</span><span class=p>;</span> <span class=k>then</span>
            <span class=nb>echo</span> -e <span class=s2>&#34;\033[31m[ERROR] Mongo start failed!\033[0m&#34;</span><span class=p>;</span>
            <span class=k>return</span> 1<span class=p>;</span>
        <span class=k>fi</span>
        sleep <span class=m>3</span>
    <span class=k>fi</span>
<span class=o>}</span>

<span class=k>function</span> run_adapter<span class=o>()</span> <span class=o>{</span>
    check_container <span class=si>${</span><span class=nv>ANYNODE_PREFIX</span><span class=si>}</span>_adapter
    <span class=k>if</span> <span class=o>[</span> <span class=nv>$?</span> <span class=o>=</span> <span class=m>1</span> <span class=o>]</span><span class=p>;</span> <span class=k>then</span>
        <span class=nb>echo</span> -e <span class=s2>&#34;\033[36m[INFO] Rightcloud server starting...... \033[0m&#34;</span>
        docker run -d <span class=si>${</span><span class=nv>DOCKER_LOG_OPTS</span><span class=si>}</span> <span class=se>\
</span><span class=se></span>               -e <span class=s2>&#34;JAVA_OPTS=-Xmx1024M -Xms512M -Xss2M -Djava.security.egd=file:/dev/./urandom&#34;</span> <span class=se>\
</span><span class=se></span>               -e <span class=s2>&#34;DB_USER=</span><span class=nv>$DB_USER</span><span class=s2>&#34;</span> <span class=se>\
</span><span class=se></span>               -e <span class=s2>&#34;DB_PASSWORD=</span><span class=nv>$DB_PASSWORD</span><span class=s2>&#34;</span> <span class=se>\
</span><span class=se></span>               -e <span class=s2>&#34;DB_URL=</span><span class=nv>$DB_URL</span><span class=s2>&#34;</span> <span class=se>\
</span><span class=se></span>               -e <span class=s2>&#34;FALCON_DB_URL=</span><span class=nv>$FALCON_DB_URL</span><span class=s2>&#34;</span> <span class=se>\
</span><span class=se></span>               -e <span class=s2>&#34;FALCON_DB_PASSWORD=</span><span class=nv>$FALCON_DB_PASSWORD</span><span class=s2>&#34;</span> <span class=se>\
</span><span class=se></span>               -e <span class=s2>&#34;RABBIT_MQ_URL=</span><span class=nv>$RABBIT_MQ_URL</span><span class=s2>&#34;</span> <span class=se>\
</span><span class=se></span>               -e <span class=s2>&#34;RABBIT_MQ_PORT=</span><span class=nv>$MQ_PORT</span><span class=s2>&#34;</span> <span class=se>\
</span><span class=se></span>               -e <span class=s2>&#34;REDIS_URL=</span><span class=nv>$REDIS_URL</span><span class=s2>&#34;</span> <span class=se>\
</span><span class=se></span>               -e <span class=s2>&#34;HOST_IP=</span><span class=nv>$HOST_IP</span><span class=s2>&#34;</span> <span class=se>\
</span><span class=se></span>               -e <span class=s2>&#34;AGENT_SERVER=</span><span class=nv>$HOST_IP</span><span class=s2>&#34;</span> <span class=se>\
</span><span class=se></span>               -e <span class=s2>&#34;AGENT_SERVER_PORT=</span><span class=nv>$SERVER_PORT</span><span class=s2>&#34;</span> <span class=se>\
</span><span class=se></span>               -e <span class=s2>&#34;FALCON_HEART_ADDR=</span><span class=nv>$FALCON_IP</span><span class=s2>:6030&#34;</span> <span class=se>\
</span><span class=se></span>               -e <span class=s2>&#34;FALCON_TRANSFER_ADDR=</span><span class=nv>$FALCON_IP</span><span class=s2>:8433&#34;</span> <span class=se>\
</span><span class=se></span>               -e <span class=s2>&#34;FALCON_TRANSFER_ADDR_HTTP=</span><span class=nv>$FALCON_IP</span><span class=s2>:6060&#34;</span> <span class=se>\
</span><span class=se></span>               -e <span class=s2>&#34;QUERY_HISTORY_URL=http://</span><span class=nv>$FALCON_IP</span><span class=s2>:9966/graph/history&#34;</span> <span class=se>\
</span><span class=se></span>               -e <span class=s2>&#34;QUERY_LAST_URL=http://</span><span class=nv>$FALCON_IP</span><span class=s2>:9966/graph/last&#34;</span> <span class=se>\
</span><span class=se></span>               -e <span class=s2>&#34;FALCON_FE_URL=http://</span><span class=nv>$FALCON_IP</span><span class=s2>:1234&#34;</span> <span class=se>\
</span><span class=se></span>               -e <span class=s2>&#34;FALCON_PORTAL_URL=http://</span><span class=nv>$FALCON_IP</span><span class=s2>:5050&#34;</span> <span class=se>\
</span><span class=se></span>               -e <span class=s2>&#34;PORTAL_URL=</span><span class=nv>$PORTAL_URL</span><span class=s2>&#34;</span> <span class=se>\
</span><span class=se></span>               -e <span class=s2>&#34;COOKIE_DOMAIN=</span><span class=nv>$COOKIE_DOMAIN</span><span class=s2>&#34;</span> <span class=se>\
</span><span class=se></span>               -v /etc/localtime:/etc/localtime <span class=se>\
</span><span class=se></span>               -e <span class=s2>&#34;PLATFORM_TYPE=</span><span class=nv>$PLATFORM_TYPE</span><span class=s2>&#34;</span> <span class=se>\
</span><span class=se></span>               -e <span class=s2>&#34;MONGODB_HOST=</span><span class=nv>$MONGODB_HOST</span><span class=s2>&#34;</span> <span class=se>\
</span><span class=se></span>               -e <span class=s2>&#34;MONGODB_USERNAME=</span><span class=nv>$MONGODB_USERNAME</span><span class=s2>&#34;</span> <span class=se>\
</span><span class=se></span>               -e <span class=s2>&#34;MONGODB_PASSWORD=</span><span class=nv>$MONGODB_PASSWORD</span><span class=s2>&#34;</span> <span class=se>\
</span><span class=se></span>               -e <span class=s2>&#34;MONGODB_PORT=</span><span class=nv>$MONGODB_PORT</span><span class=s2>&#34;</span> <span class=se>\
</span><span class=se></span>               --name <span class=si>${</span><span class=nv>ANYNODE_PREFIX</span><span class=si>}</span>_adapter <span class=se>\
</span><span class=se></span>               <span class=si>${</span><span class=nv>ADAPTER_TAG</span><span class=si>}</span>
        <span class=k>if</span> <span class=o>[</span> <span class=nv>$?</span> -ne <span class=m>0</span> <span class=o>]</span><span class=p>;</span> <span class=k>then</span>
            <span class=nb>echo</span> -e <span class=s2>&#34;\033[31m[ERROR] Rightcloud server start failed!\033[0m&#34;</span><span class=p>;</span>
            <span class=k>return</span> 1<span class=p>;</span>
        <span class=k>fi</span>
        sleep <span class=m>3</span>
    <span class=k>fi</span>
<span class=o>}</span>

<span class=k>function</span> run_dbmigration<span class=o>()</span> <span class=o>{</span>
    docker run --rm <span class=se>\
</span><span class=se></span>           <span class=nv>$DB_IMAGE_TAG</span> <span class=se>\
</span><span class=se></span>           -outOfOrder<span class=o>=</span><span class=nb>true</span> <span class=se>\
</span><span class=se></span>           -ignoreMissingMigrations<span class=o>=</span><span class=nb>true</span> <span class=se>\
</span><span class=se></span>           -placeholderReplacement<span class=o>=</span><span class=nb>true</span> <span class=se>\
</span><span class=se></span>           -placeholderPrefix<span class=o>=</span><span class=c1>#[ \</span>
                                 -placeholderSuffix<span class=o>=]</span> <span class=se>\
</span><span class=se></span>           -table<span class=o>=</span>schema_version <span class=se>\
</span><span class=se></span>           -url<span class=o>=</span><span class=s2>&#34;jdbc:mysql://</span><span class=si>${</span><span class=nv>DB_URL</span><span class=si>}</span><span class=s2>/rightcloud?useUnicode=true&amp;characterEncoding=utf-8&amp;useSSL=false&#34;</span> -schemas<span class=o>=</span>rightcloud -user<span class=o>=</span><span class=s2>&#34;</span><span class=si>${</span><span class=nv>DB_USER</span><span class=si>}</span><span class=s2>&#34;</span> -password<span class=o>=</span><span class=s2>&#34;</span><span class=nv>$DB_PASSWORD</span><span class=s2>&#34;</span> migrate
<span class=o>}</span>

<span class=k>function</span> run_console<span class=o>()</span> <span class=o>{</span>

    check_container <span class=si>${</span><span class=nv>ANYNODE_PREFIX</span><span class=si>}</span>_console
    <span class=k>if</span> <span class=o>[</span> <span class=nv>$?</span> <span class=o>=</span> <span class=m>1</span> <span class=o>]</span><span class=p>;</span> <span class=k>then</span>
        <span class=nb>echo</span> -e <span class=s2>&#34;\033[36m[INFO] Rightcloud console starting...... \033[0m&#34;</span>
        <span class=c1># docker run -d ${DOCKER_LOG_OPTS} -p ${CONSOLE_PORT}:80 \</span>
        <span class=c1>#        -e CONSOLE_ADDRESS=${CONSOLE_ADDRESS} \</span>
        <span class=c1>#        -e CONSOLE_PORT=${CONSOLE_PORT} \</span>
        <span class=c1>#        -e PROTOCOL=${PROTOCOL} \</span>
        <span class=c1>#        -e WEB_SSH_PORT=${WEB_SSH_PORT} \</span>
        <span class=c1>#        -e UPSTREAM_SERVER=${UPSTREAM_SERVER} \</span>
        <span class=c1>#        -e COOKIE_DOMAIN=${COOKIE_DOMAIN} \</span>
        <span class=c1>#        -e PLATFORM_TYPE=private \</span>
        <span class=c1>#        -e REST_URL=${REST_URL} \</span>
        <span class=c1>#        -e WEBSOCKET_URL=${WEBSOCKET_URL} \</span>
        <span class=c1>#        -e UPSTREAM_DCIMSERVER=${UPSTREAM_DCIMSERVER} \</span>
        <span class=c1>#        -e DOC_URL=${DOC_URL} \</span>
        <span class=c1>#        -v /etc/localtime:/etc/localtime \</span>
        <span class=c1>#        -v /usr/local/rightcloud/files:/usr/share/nginx/html/user-console/static/files \</span>
        <span class=c1>#        --name ${ANYNODE_PREFIX}_console \</span>
        <span class=c1>#        ${CONSOLE_TAG}</span>

        docker run -d <span class=si>${</span><span class=nv>DOCKER_LOG_OPTS</span><span class=si>}</span> -p <span class=si>${</span><span class=nv>CONSOLE_PORT</span><span class=si>}</span>:80 <span class=se>\
</span><span class=se></span>                   -e <span class=nv>UPSTREAM_SERVER</span><span class=o>=</span><span class=si>${</span><span class=nv>UPSTREAM_SERVER</span><span class=si>}</span> <span class=se>\
</span><span class=se></span>                   -e <span class=nv>REST_URL</span><span class=o>=</span><span class=si>${</span><span class=nv>REST_URL</span><span class=si>}</span> <span class=se>\
</span><span class=se></span>                   -e <span class=nv>WEBSOCKET_URL</span><span class=o>=</span><span class=si>${</span><span class=nv>WEBSOCKET_URL</span><span class=si>}</span> <span class=se>\
</span><span class=se></span>                   -e <span class=nv>UPSTREAM_DCIMSERVER</span><span class=o>=</span><span class=si>${</span><span class=nv>UPSTREAM_DCIMSERVER</span><span class=si>}</span> <span class=se>\
</span><span class=se></span>                   -e <span class=nv>DOC_URL</span><span class=o>=</span><span class=si>${</span><span class=nv>DOC_URL</span><span class=si>}</span> <span class=se>\
</span><span class=se></span>                   -e <span class=nv>WEBSSH_URL</span><span class=o>=</span><span class=si>${</span><span class=nv>WEBSSH_URL</span><span class=si>}</span> <span class=se>\
</span><span class=se></span>                   -v /etc/localtime:/etc/localtime <span class=se>\
</span><span class=se></span>                   -v /usr/local/rightcloud/nfs/files:/usr/share/nginx/html/user-console/static/files <span class=se>\
</span><span class=se></span>                   --name <span class=si>${</span><span class=nv>ANYNODE_PREFIX</span><span class=si>}</span>_console <span class=se>\
</span><span class=se></span>                   <span class=si>${</span><span class=nv>CONSOLE_TAG</span><span class=si>}</span>
        <span class=k>if</span> <span class=o>[</span> <span class=nv>$?</span> -ne <span class=m>0</span> <span class=o>]</span><span class=p>;</span> <span class=k>then</span>
            <span class=nb>echo</span> -e <span class=s2>&#34;\033[31m[ERROR] Rightcloud console start failed!\033[0m&#34;</span><span class=p>;</span>
            <span class=k>return</span> 1<span class=p>;</span>
        <span class=k>fi</span>
        sleep <span class=m>3</span>
    <span class=k>fi</span>
<span class=o>}</span>


<span class=k>function</span> run_console2<span class=o>()</span> <span class=o>{</span>

    check_container <span class=si>${</span><span class=nv>ANYNODE_PREFIX</span><span class=si>}</span>_console2
    <span class=k>if</span> <span class=o>[</span> <span class=nv>$?</span> <span class=o>=</span> <span class=m>1</span> <span class=o>]</span><span class=p>;</span> <span class=k>then</span>
        <span class=nb>echo</span> -e <span class=s2>&#34;\033[36m[INFO] Rightcloud console starting...... \033[0m&#34;</span>
        <span class=c1># docker run -d ${DOCKER_LOG_OPTS} -p ${CONSOLE_PORT}:80 \</span>
        <span class=c1>#        -e CONSOLE_ADDRESS=${CONSOLE_ADDRESS} \</span>
        <span class=c1>#        -e CONSOLE_PORT=${CONSOLE_PORT} \</span>
        <span class=c1>#        -e PROTOCOL=${PROTOCOL} \</span>
        <span class=c1>#        -e WEB_SSH_PORT=${WEB_SSH_PORT} \</span>
        <span class=c1>#        -e UPSTREAM_SERVER=${UPSTREAM_SERVER} \</span>
        <span class=c1>#        -e COOKIE_DOMAIN=${COOKIE_DOMAIN} \</span>
        <span class=c1>#        -e PLATFORM_TYPE=private \</span>
        <span class=c1>#        -e REST_URL=${REST_URL} \</span>
        <span class=c1>#        -e WEBSOCKET_URL=${WEBSOCKET_URL} \</span>
        <span class=c1>#        -e UPSTREAM_DCIMSERVER=${UPSTREAM_DCIMSERVER} \</span>
        <span class=c1>#        -e DOC_URL=${DOC_URL} \</span>
        <span class=c1>#        -v /etc/localtime:/etc/localtime \</span>
        <span class=c1>#        -v /usr/local/rightcloud/files:/usr/share/nginx/html/user-console/static/files \</span>
        <span class=c1>#        --name ${ANYNODE_PREFIX}_console \</span>
        <span class=c1>#        ${CONSOLE_TAG}</span>

        docker run -d <span class=si>${</span><span class=nv>DOCKER_LOG_OPTS</span><span class=si>}</span> -p <span class=si>${</span><span class=nv>CONSOLE_PORT2</span><span class=si>}</span>:80 <span class=se>\
</span><span class=se></span>                   -e <span class=nv>UPSTREAM_SERVER</span><span class=o>=</span><span class=si>${</span><span class=nv>UPSTREAM_SERVER</span><span class=si>}</span> <span class=se>\
</span><span class=se></span>                   -e <span class=nv>REST_URL</span><span class=o>=</span><span class=si>${</span><span class=nv>REST_URL2</span><span class=si>}</span> <span class=se>\
</span><span class=se></span>                   -e <span class=nv>WEBSOCKET_URL</span><span class=o>=</span><span class=si>${</span><span class=nv>WEBSOCKET_URL2</span><span class=si>}</span> <span class=se>\
</span><span class=se></span>                   -e <span class=nv>UPSTREAM_DCIMSERVER</span><span class=o>=</span><span class=si>${</span><span class=nv>UPSTREAM_DCIMSERVER</span><span class=si>}</span> <span class=se>\
</span><span class=se></span>                   -e <span class=nv>DOC_URL</span><span class=o>=</span><span class=si>${</span><span class=nv>DOC_URL2</span><span class=si>}</span> <span class=se>\
</span><span class=se></span>                   -e <span class=nv>WEBSSH_URL</span><span class=o>=</span><span class=si>${</span><span class=nv>WEBSSH_URL2</span><span class=si>}</span> <span class=se>\
</span><span class=se></span>                   -v /etc/localtime:/etc/localtime <span class=se>\
</span><span class=se></span>                   -v /usr/local/rightcloud/nfs/files:/usr/share/nginx/html/user-console/static/files <span class=se>\
</span><span class=se></span>                   --name <span class=si>${</span><span class=nv>ANYNODE_PREFIX</span><span class=si>}</span>_console2 <span class=se>\
</span><span class=se></span>                   <span class=si>${</span><span class=nv>CONSOLE_TAG</span><span class=si>}</span>
        <span class=k>if</span> <span class=o>[</span> <span class=nv>$?</span> -ne <span class=m>0</span> <span class=o>]</span><span class=p>;</span> <span class=k>then</span>
            <span class=nb>echo</span> -e <span class=s2>&#34;\033[31m[ERROR] Rightcloud console start failed!\033[0m&#34;</span><span class=p>;</span>
            <span class=k>return</span> 1<span class=p>;</span>
        <span class=k>fi</span>
        sleep <span class=m>3</span>
    <span class=k>fi</span>
<span class=o>}</span>


<span class=k>function</span> run_server<span class=o>()</span> <span class=o>{</span>

    check_container <span class=si>${</span><span class=nv>ANYNODE_PREFIX</span><span class=si>}</span>_server
    <span class=k>if</span> <span class=o>[</span> <span class=nv>$?</span> <span class=o>=</span> <span class=m>1</span> <span class=o>]</span><span class=p>;</span> <span class=k>then</span>
        <span class=nb>echo</span> -e <span class=s2>&#34;\033[36m[INFO] Rightcloud server starting...... \033[0m&#34;</span>
        docker run -d <span class=si>${</span><span class=nv>DOCKER_LOG_OPTS</span><span class=si>}</span> <span class=se>\
</span><span class=se></span>               -p <span class=si>${</span><span class=nv>SERVER_PORT_H</span><span class=si>}</span>:8080 <span class=se>\
</span><span class=se></span>               -p <span class=si>${</span><span class=nv>SERVER_PORT</span><span class=si>}</span>:8443 <span class=se>\
</span><span class=se></span>               -p <span class=si>${</span><span class=nv>WEB_SSH_PORT</span><span class=si>}</span>:4200 <span class=se>\
</span><span class=se></span>               -e <span class=s2>&#34;DB_USER=</span><span class=nv>$DB_USER</span><span class=s2>&#34;</span> <span class=se>\
</span><span class=se></span>               -e <span class=s2>&#34;DB_PASSWORD=</span><span class=nv>$DB_PASSWORD</span><span class=s2>&#34;</span> <span class=se>\
</span><span class=se></span>               -e <span class=s2>&#34;JAVA_OPTS=-Xmx1024M -Xms512M -Xss2M -Djava.security.egd=file:/dev/./urandom&#34;</span> <span class=se>\
</span><span class=se></span>               -e <span class=s2>&#34;DB_URL=</span><span class=nv>$DB_URL</span><span class=s2>&#34;</span> <span class=se>\
</span><span class=se></span>               -e <span class=s2>&#34;FALCON_DB_URL=</span><span class=nv>$FALCON_DB_URL</span><span class=s2>&#34;</span> <span class=se>\
</span><span class=se></span>               -e <span class=s2>&#34;FALCON_DB_PASSWORD=</span><span class=nv>$FALCON_DB_PASSWORD</span><span class=s2>&#34;</span> <span class=se>\
</span><span class=se></span>               -e <span class=s2>&#34;FALCON_DB_USER=</span><span class=nv>$DB_USER</span><span class=s2>&#34;</span> <span class=se>\
</span><span class=se></span>               -e <span class=s2>&#34;RABBIT_MQ_URL=</span><span class=nv>$RABBIT_MQ_URL</span><span class=s2>&#34;</span> <span class=se>\
</span><span class=se></span>               -e <span class=s2>&#34;RABBIT_MQ_PORT=</span><span class=nv>$MQ_PORT</span><span class=s2>&#34;</span> <span class=se>\
</span><span class=se></span>               -e <span class=s2>&#34;REDIS_URL=</span><span class=nv>$REDIS_URL</span><span class=s2>&#34;</span> <span class=se>\
</span><span class=se></span>               -e <span class=s2>&#34;HOST_IP=</span><span class=nv>$HOST_IP</span><span class=s2>&#34;</span> <span class=se>\
</span><span class=se></span>               -e <span class=s2>&#34;AGENT_SERVER=</span><span class=nv>$VIP</span><span class=s2>&#34;</span> <span class=se>\
</span><span class=se></span>               -e <span class=s2>&#34;AGENT_SERVER_PORT=</span><span class=nv>$SERVER_PORT</span><span class=s2>&#34;</span> <span class=se>\
</span><span class=se></span>               -e <span class=s2>&#34;FALCON_HEART_ADDR=</span><span class=nv>$FALCON_IP</span><span class=s2>:6030&#34;</span> <span class=se>\
</span><span class=se></span>               -e <span class=s2>&#34;FALCON_TRANSFER_ADDR=</span><span class=nv>$FALCON_IP</span><span class=s2>:8433&#34;</span> <span class=se>\
</span><span class=se></span>               -e <span class=s2>&#34;FALCON_TRANSFER_ADDR_HTTP=</span><span class=nv>$FALCON_IP</span><span class=s2>:6060&#34;</span> <span class=se>\
</span><span class=se></span>               -e <span class=s2>&#34;QUERY_HISTORY_URL=http://</span><span class=nv>$FALCON_IP</span><span class=s2>:9966/graph/history&#34;</span> <span class=se>\
</span><span class=se></span>               -e <span class=s2>&#34;QUERY_LAST_URL=http://</span><span class=nv>$FALCON_IP</span><span class=s2>:9966/graph/last&#34;</span> <span class=se>\
</span><span class=se></span>               -e <span class=s2>&#34;FALCON_FE_URL=http://</span><span class=nv>$FALCON_IP</span><span class=s2>:1234&#34;</span> <span class=se>\
</span><span class=se></span>               -e <span class=s2>&#34;FALCON_PORTAL_URL=http://</span><span class=nv>$FALCON_IP</span><span class=s2>:5050&#34;</span> <span class=se>\
</span><span class=se></span>               -e <span class=s2>&#34;PORTAL_URL=</span><span class=nv>$PORTAL_URL</span><span class=s2>&#34;</span> <span class=se>\
</span><span class=se></span>               -e <span class=s2>&#34;COOKIE_DOMAIN=</span><span class=nv>$COOKIE_DOMAIN</span><span class=s2>&#34;</span> <span class=se>\
</span><span class=se></span>               -e <span class=s2>&#34;PLATFORM_TYPE=</span><span class=nv>$PLATFORM_TYPE</span><span class=s2>&#34;</span> <span class=se>\
</span><span class=se></span>               -e <span class=s2>&#34;MONGODB_HOST=</span><span class=nv>$MONGODB_HOST</span><span class=s2>&#34;</span> <span class=se>\
</span><span class=se></span>               -e <span class=s2>&#34;MONGODB_USERNAME=</span><span class=nv>$MONGODB_USERNAME</span><span class=s2>&#34;</span> <span class=se>\
</span><span class=se></span>               -e <span class=s2>&#34;MONGODB_PASSWORD=</span><span class=nv>$MONGODB_PASSWORD</span><span class=s2>&#34;</span> <span class=se>\
</span><span class=se></span>               -e <span class=s2>&#34;MONGODB_PORT=</span><span class=nv>$MONGODB_PORT</span><span class=s2>&#34;</span> <span class=se>\
</span><span class=se></span>               -e <span class=s2>&#34;GUACD_HOST=</span><span class=si>${</span><span class=nv>GUACD_HOST</span><span class=si>}</span><span class=s2>&#34;</span> <span class=se>\
</span><span class=se></span>               -e <span class=s2>&#34;GUACD_PORT=</span><span class=si>${</span><span class=nv>GUACD_PORT</span><span class=si>}</span><span class=s2>&#34;</span> <span class=se>\
</span><span class=se></span>               -e <span class=s2>&#34;HA_DEPLOY=true&#34;</span> <span class=se>\
</span><span class=se></span>               -v /etc/localtime:/etc/localtime <span class=se>\
</span><span class=se></span>               -v /usr/local/rightcloud/nfs/files:/opt/rightcloud/files <span class=se>\
</span><span class=se></span>               --name <span class=si>${</span><span class=nv>ANYNODE_PREFIX</span><span class=si>}</span>_server <span class=se>\
</span><span class=se></span>               <span class=si>${</span><span class=nv>SERVER_TAG</span><span class=si>}</span>
        <span class=k>if</span> <span class=o>[</span> <span class=nv>$?</span> -ne <span class=m>0</span> <span class=o>]</span><span class=p>;</span> <span class=k>then</span>
            <span class=nb>echo</span> -e <span class=s2>&#34;\033[31m[ERROR] Rightcloud server start failed!\033[0m&#34;</span><span class=p>;</span>
            <span class=k>return</span> 1<span class=p>;</span>
        <span class=k>fi</span>
        sleep <span class=m>3</span>
    <span class=k>fi</span>
<span class=o>}</span>

<span class=k>function</span> run_schedule<span class=o>()</span> <span class=o>{</span>
  <span class=c1>#statements</span>
  check_container <span class=si>${</span><span class=nv>ANYNODE_PREFIX</span><span class=si>}</span>_schedule
  <span class=k>if</span> <span class=o>[</span> <span class=nv>$?</span> <span class=o>=</span> <span class=m>1</span> <span class=o>]</span><span class=p>;</span> <span class=k>then</span>
      <span class=nb>echo</span> -e <span class=s2>&#34;\033[36m[INFO] Rightcloud schedule starting...... \033[0m&#34;</span>
      docker run -d <span class=si>${</span><span class=nv>DOCKER_LOG_OPTS</span><span class=si>}</span> -e <span class=s2>&#34;DB_HOST=</span><span class=si>${</span><span class=nv>HOST_IP</span><span class=si>}</span><span class=s2>&#34;</span> <span class=se>\
</span><span class=se></span>             -e <span class=s2>&#34;DB_PORT=</span><span class=si>${</span><span class=nv>MYSQL_PORT</span><span class=si>}</span><span class=s2>&#34;</span> <span class=se>\
</span><span class=se></span>             -e <span class=s2>&#34;DB_USERNAME=</span><span class=nv>$DB_USER</span><span class=s2>&#34;</span> <span class=se>\
</span><span class=se></span>             -e <span class=s2>&#34;DB_PASSWORD=</span><span class=nv>$DB_PASSWORD</span><span class=s2>&#34;</span> <span class=se>\
</span><span class=se></span>             -e <span class=s2>&#34;REDIS_HOST=</span><span class=si>${</span><span class=nv>REDIS_IP</span><span class=si>}</span><span class=s2> &#34;</span> <span class=se>\
</span><span class=se></span>             -e <span class=s2>&#34;REDIS_PORT=</span><span class=si>${</span><span class=nv>REDIS_PORT</span><span class=si>}</span><span class=s2> &#34;</span> <span class=se>\
</span><span class=se></span>             -e <span class=s2>&#34;MQ_HOST=</span><span class=si>${</span><span class=nv>MQ_URL</span><span class=si>}</span><span class=s2> &#34;</span> <span class=se>\
</span><span class=se></span>             -e <span class=s2>&#34;MQ_PORT=</span><span class=si>${</span><span class=nv>MQ_PORT</span><span class=si>}</span><span class=s2>&#34;</span> <span class=se>\
</span><span class=se></span>             -e <span class=s2>&#34;MQ_USERNAME=</span><span class=si>${</span><span class=nv>MQ_USER</span><span class=si>}</span><span class=s2>&#34;</span> <span class=se>\
</span><span class=se></span>             -e <span class=s2>&#34;MQ_PASSWORD=</span><span class=si>${</span><span class=nv>MQ_PASS</span><span class=si>}</span><span class=s2>&#34;</span> <span class=se>\
</span><span class=se></span>             -e <span class=s2>&#34;MONGODB_HOST=</span><span class=si>${</span><span class=nv>MONGODB_HOST</span><span class=si>}</span><span class=s2>&#34;</span> <span class=se>\
</span><span class=se></span>             -e <span class=s2>&#34;MONGODB_USERNAME=</span><span class=si>${</span><span class=nv>MONGODB_USERNAME</span><span class=si>}</span><span class=s2>&#34;</span> <span class=se>\
</span><span class=se></span>             -e <span class=s2>&#34;MONGODB_PASSWORD=</span><span class=si>${</span><span class=nv>MONGODB_PASSWORD</span><span class=si>}</span><span class=s2>&#34;</span> <span class=se>\
</span><span class=se></span>             -e <span class=s2>&#34;MONGODB_PORT=</span><span class=si>${</span><span class=nv>MONGODB_PORT</span><span class=si>}</span><span class=s2>&#34;</span> <span class=se>\
</span><span class=se></span>             -e <span class=s2>&#34;PROFILES_ACTIVE=cloudstar&#34;</span> <span class=se>\
</span><span class=se></span>             -v <span class=s2>&#34;/etc/localtime:/etc/localtime&#34;</span> <span class=se>\
</span><span class=se></span>             --name <span class=si>${</span><span class=nv>ANYNODE_PREFIX</span><span class=si>}</span>_schedule <span class=se>\
</span><span class=se></span>             <span class=si>${</span><span class=nv>SCHEDULE_TAG</span><span class=si>}</span>
      <span class=k>if</span> <span class=o>[</span> <span class=nv>$?</span> -ne <span class=m>0</span> <span class=o>]</span><span class=p>;</span> <span class=k>then</span>
          <span class=nb>echo</span> -e <span class=s2>&#34;\033[31m[ERROR] Rightcloud portal start failed!\033[0m&#34;</span><span class=p>;</span>
          <span class=k>return</span> 1<span class=p>;</span>
      <span class=k>fi</span>
      sleep <span class=m>3</span>
  <span class=k>fi</span>
<span class=o>}</span>

<span class=k>function</span> run_viclient<span class=o>()</span> <span class=o>{</span>
    <span class=c1>#statements</span>
    check_container <span class=si>${</span><span class=nv>ANYNODE_PREFIX</span><span class=si>}</span>_viclient
    <span class=k>if</span> <span class=o>[</span> <span class=nv>$?</span> <span class=o>=</span> <span class=m>1</span> <span class=o>]</span><span class=p>;</span> <span class=k>then</span>
        <span class=nb>echo</span> -e <span class=s2>&#34;\033[36m[INFO] Rightcloud vi-client starting...... \033[0m&#34;</span>
        docker run -d <span class=si>${</span><span class=nv>DOCKER_LOG_OPTS</span><span class=si>}</span> <span class=se>\
</span><span class=se></span>               -e <span class=s2>&#34;MQ_HOST=</span><span class=si>${</span><span class=nv>MQ_URL</span><span class=si>}</span><span class=s2> &#34;</span> <span class=se>\
</span><span class=se></span>               -e <span class=s2>&#34;MQ_PORT=</span><span class=si>${</span><span class=nv>MQ_PORT</span><span class=si>}</span><span class=s2>&#34;</span> <span class=se>\
</span><span class=se></span>               -e <span class=s2>&#34;MQ_USERNAME=</span><span class=si>${</span><span class=nv>MQ_USER</span><span class=si>}</span><span class=s2>&#34;</span> <span class=se>\
</span><span class=se></span>               -e <span class=s2>&#34;MQ_PASSWORD=</span><span class=si>${</span><span class=nv>MQ_PASS</span><span class=si>}</span><span class=s2>&#34;</span> <span class=se>\
</span><span class=se></span>               -e <span class=s2>&#34;PROFILES_ACTIVE=cloudstar&#34;</span> <span class=se>\
</span><span class=se></span>               -v <span class=s2>&#34;/etc/localtime:/etc/localtime&#34;</span> <span class=se>\
</span><span class=se></span>               --name <span class=si>${</span><span class=nv>ANYNODE_PREFIX</span><span class=si>}</span>_viclient <span class=se>\
</span><span class=se></span>               <span class=si>${</span><span class=nv>VICLIENT_TAG</span><span class=si>}</span>
        <span class=k>if</span> <span class=o>[</span> <span class=nv>$?</span> -ne <span class=m>0</span> <span class=o>]</span><span class=p>;</span> <span class=k>then</span>
            <span class=nb>echo</span> -e <span class=s2>&#34;\033[31m[ERROR] Rightcloud vi-client start failed!\033[0m&#34;</span><span class=p>;</span>
            <span class=k>return</span> 1<span class=p>;</span>
        <span class=k>fi</span>
        sleep <span class=m>3</span>
    <span class=k>fi</span>
<span class=o>}</span>


<span class=k>function</span> run_portal<span class=o>()</span> <span class=o>{</span>
    check_container <span class=si>${</span><span class=nv>ANYNODE_PREFIX</span><span class=si>}</span>_portal
    <span class=k>if</span> <span class=o>[</span> <span class=nv>$?</span> <span class=o>=</span> <span class=m>1</span> <span class=o>]</span><span class=p>;</span> <span class=k>then</span>
        <span class=nb>echo</span> -e <span class=s2>&#34;\033[36m[INFO] Rightcloud portal starting...... \033[0m&#34;</span>
        docker run -d <span class=si>${</span><span class=nv>DOCKER_LOG_OPTS</span><span class=si>}</span> -p <span class=si>${</span><span class=nv>ANYNODE_PORTAL_PORT</span><span class=si>}</span>:80  <span class=se>\
</span><span class=se></span>               -e <span class=s2>&#34;CONSOLE_ADDRESS=</span><span class=nv>$CONSOLE_ADDRESS</span><span class=s2>&#34;</span> <span class=se>\
</span><span class=se></span>               -e <span class=s2>&#34;CONSOLE_PORT=</span><span class=nv>$CONSOLE_PORT</span><span class=s2>&#34;</span> <span class=se>\
</span><span class=se></span>               -e <span class=s2>&#34;COOKIE_DOMAIN=</span><span class=nv>$COOKIE_DOMAIN</span><span class=s2>&#34;</span> <span class=se>\
</span><span class=se></span>               -e <span class=s2>&#34;PROTOCOL=</span><span class=nv>$PROTOCOL</span><span class=s2>&#34;</span> <span class=se>\
</span><span class=se></span>               -e <span class=s2>&#34;UPSTREAM_SERVER=</span><span class=nv>$UPSTREAM_SERVER</span><span class=s2>&#34;</span> <span class=se>\
</span><span class=se></span>               -v /etc/localtime:/etc/localtime <span class=se>\
</span><span class=se></span>               --name <span class=si>${</span><span class=nv>ANYNODE_PREFIX</span><span class=si>}</span>_portal <span class=se>\
</span><span class=se></span>               <span class=si>${</span><span class=nv>PORTAL_TAG</span><span class=si>}</span>
        <span class=k>if</span> <span class=o>[</span> <span class=nv>$?</span> -ne <span class=m>0</span> <span class=o>]</span><span class=p>;</span> <span class=k>then</span>
            <span class=nb>echo</span> -e <span class=s2>&#34;\033[31m[ERROR] Rightcloud portal start failed!\033[0m&#34;</span><span class=p>;</span>
            <span class=k>return</span> 1<span class=p>;</span>
        <span class=k>fi</span>
        sleep <span class=m>3</span>
    <span class=k>fi</span>
<span class=o>}</span>

gen_sql_update<span class=o>()</span> <span class=o>{</span>
    cat &gt; <span class=si>${</span><span class=nv>WORKDIR</span><span class=p>=</span><span class=si>}</span>/b1.sql <span class=s>&lt;&lt;EOF
</span><span class=s>UPDATE \`rightcloud\`.\`sys_m_config\` SET \`CONFIG_VALUE\`=&#39;http://${PUBLIC_IP}:${CONSOLE_HA_PORT}/html/user/email-change-validate.html&#39;  WHERE \`CONFIG_KEY\`=&#39;email.change.validate&#39;;
</span><span class=s>UPDATE \`rightcloud\`.\`sys_m_config\` SET \`CONFIG_VALUE\`=&#39;http://${PUBLIC_IP}:${CONSOLE_HA_PORT}/&#39;  WHERE \`CONFIG_KEY\`=&#39;portal.url&#39;;
</span><span class=s>UPDATE \`rightcloud\`.\`sys_m_config\` SET \`CONFIG_VALUE\`=&#39;http://${PUBLIC_IP}:${CONSOLE_HA_PORT}/html/user/initpwd-reset.html&#39;  WHERE \`CONFIG_KEY\`=&#39;server.account.active.url&#39;;
</span><span class=s>UPDATE \`rightcloud\`.\`sys_m_config\` SET \`CONFIG_VALUE\`=&#39;http://${PUBLIC_IP}:${CONSOLE_HA_PORT}/html/user/resetpwd-reset.html&#39;  WHERE \`CONFIG_KEY\`=&#39;mail.account.change.pwd.url&#39;;
</span><span class=s>UPDATE \`rightcloud\`.\`sys_m_config\` SET \`CONFIG_VALUE\`=&#39;http://${PUBLIC_IP}:${CONSOLE_HA_PORT}/login.html&#39;  WHERE \`CONFIG_KEY\`=&#39;console.login.url&#39;;
</span><span class=s>UPDATE \`rightcloud\`.\`script_param_config\` SET \`default_value\`=&#39;${FALCON_IP_ADDRESS}:6060&#39;  WHERE \`name\`=&#39;open_falcon_transfer_addr_http&#39;;
</span><span class=s>UPDATE \`rightcloud\`.\`sys_m_config\` SET \`config_value\` = &#39;${VIP}:${MQ_HA_PORT}&#39; WHERE \`config_key\` = &#39;rclink.mq.server&#39;;
</span><span class=s>UPDATE \`rightcloud\`.\`sys_m_config\` SET \`CONFIG_VALUE\` = &#39;http://${PUBLIC_IP}:${CONSOLE_HA_PORT}/resetpwd-reset.html&#39;  WHERE \`CONFIG_KEY\` = &#39;mail.account.change.pwd.url&#39;;
</span><span class=s>UPDATE \`rightcloud\`.\`sys_m_config\` SET \`CONFIG_VALUE\` = &#39;http://${PUBLIC_IP}:${CONSOLE_HA_PORT}/api/v1/alarms/falcon/callback&#39;  WHERE \`CONFIG_KEY\` = &#39;openfalcon.alarm.callback.url&#39;;
</span><span class=s>EOF</span>
<span class=o>}</span>

disable_qingniu<span class=o>()</span> <span class=o>{</span>
    cat &gt; <span class=si>${</span><span class=nv>WORKDIR</span><span class=si>}</span>/b2.sql <span class=s>&lt;&lt;EOF
</span><span class=s>UPDATE `sys_m_code` SET `ENABLED`=&#39;0&#39; WHERE (`CODE_SID`=&#39;5012&#39;);
</span><span class=s>UPDATE `sys_m_code` SET `ENABLED`=&#39;0&#39; WHERE (`CODE_SID`=&#39;6248&#39;);
</span><span class=s>UPDATE `sys_m_code` SET `ATTRIBUTE_2`=&#39;0&#39; WHERE (`CODE_SID`=&#39;5187&#39;);
</span><span class=s>UPDATE `sys_m_code` SET `ATTRIBUTE_2`=&#39;0&#39; WHERE (`CODE_SID`=&#39;6249&#39;);
</span><span class=s>EOF</span>
<span class=o>}</span>


<span class=k>function</span> run_mysql<span class=o>()</span> <span class=o>{</span>
    check_container <span class=si>${</span><span class=nv>ANYNODE_PREFIX</span><span class=si>}</span>_mysql

    <span class=k>if</span> <span class=o>[</span> <span class=nv>$?</span> <span class=o>=</span> <span class=m>1</span> <span class=o>]</span><span class=p>;</span> <span class=k>then</span>
        <span class=nb>echo</span> -e <span class=s2>&#34;\033[36m[INFO] Rightcloud mysql starting...... \033[0m&#34;</span>
        docker run -d <span class=si>${</span><span class=nv>DOCKER_LOG_OPTS</span><span class=si>}</span> -p <span class=si>${</span><span class=nv>MYSQL_PORT</span><span class=si>}</span>:3306  -v <span class=si>${</span><span class=nv>WORKDIR</span><span class=si>}</span>/data:/var/lib/mysql  -e <span class=nv>MYSQL_ROOT_PASSWORD</span><span class=o>=</span>root-mysql-pw  --name <span class=si>${</span><span class=nv>ANYNODE_PREFIX</span><span class=si>}</span>_mysql  -v /etc/localtime:/etc/localtime image.rightcloud.com.cn/library/mysql:5.7.20
        <span class=k>if</span> <span class=o>[</span> <span class=nv>$?</span> -ne <span class=m>0</span> <span class=o>]</span><span class=p>;</span> <span class=k>then</span>
            <span class=nb>echo</span> -e <span class=s2>&#34;\033[31m[ERROR] Rightcloud mysql start failed!\033[0m&#34;</span><span class=p>;</span>
            <span class=k>return</span> 1<span class=p>;</span>
        <span class=k>fi</span>

        <span class=nv>mysql</span><span class=o>=(</span> mysql -uroot -h<span class=si>${</span><span class=nv>HOSTIP</span><span class=si>}</span> -proot-mysql-pw <span class=o>)</span>

        <span class=k>for</span> i in <span class=o>{</span>600..0<span class=o>}</span><span class=p>;</span> <span class=k>do</span>
            <span class=k>if</span> <span class=nb>echo</span> <span class=s1>&#39;SELECT 1&#39;</span> <span class=p>|</span> <span class=s2>&#34;</span><span class=si>${</span><span class=nv>mysql</span><span class=p>[@]</span><span class=si>}</span><span class=s2>&#34;</span> <span class=p>&amp;</span>&gt; /dev/null<span class=p>;</span> <span class=k>then</span>
                <span class=nb>echo</span> <span class=s2>&#34;MySQL is ready&#34;</span>
                <span class=nb>break</span>
            <span class=k>fi</span>
            <span class=nb>echo</span> <span class=s1>&#39;MySQL init process in progress...&#39;</span>
            sleep <span class=m>1</span>
        <span class=k>done</span>

        <span class=k>if</span> <span class=o>[</span> <span class=s2>&#34;</span><span class=nv>$i</span><span class=s2>&#34;</span> <span class=o>=</span> <span class=m>0</span> <span class=o>]</span><span class=p>;</span> <span class=k>then</span>
            <span class=nb>echo</span> &gt;<span class=p>&amp;</span><span class=m>2</span> <span class=s1>&#39;MySQL init process failed.&#39;</span>
            <span class=k>return</span> <span class=m>1</span>
        <span class=k>fi</span>

        <span class=c1># sleep 60</span>
        gen_sql_update
        docker cp <span class=si>${</span><span class=nv>WORKDIR</span><span class=si>}</span>/b1.sql <span class=si>${</span><span class=nv>ANYNODE_PREFIX</span><span class=si>}</span>_mysql:/root/
        docker <span class=nb>exec</span> <span class=si>${</span><span class=nv>ANYNODE_PREFIX</span><span class=si>}</span>_mysql sh -c <span class=s2>&#34;mysql -uroot -proot-mysql-pw rightcloud &lt; /root/b1.sql&#34;</span>
    <span class=k>fi</span>
<span class=o>}</span>

<span class=k>function</span> run_rabbitmq<span class=o>()</span> <span class=o>{</span>
    check_container <span class=si>${</span><span class=nv>ANYNODE_PREFIX</span><span class=si>}</span>_rabbitmq

    <span class=k>if</span> <span class=o>[</span> <span class=nv>$?</span> <span class=o>=</span> <span class=m>1</span> <span class=o>]</span><span class=p>;</span> <span class=k>then</span>
        <span class=nb>echo</span> -e <span class=s2>&#34;\033[36m[INFO] Rightcloud rabbitmq starting...... \033[0m&#34;</span>
        docker run -d <span class=si>${</span><span class=nv>DOCKER_LOG_OPTS</span><span class=si>}</span> -p 5671:5171 -p <span class=si>${</span><span class=nv>MQ_PORT</span><span class=si>}</span>:5672 -p 15671:15671 -p <span class=si>${</span><span class=nv>MQ_MGT_PORT</span><span class=si>}</span>:15672 --name <span class=si>${</span><span class=nv>ANYNODE_PREFIX</span><span class=si>}</span>_rabbitmq image.rightcloud.com.cn/library/rabbitmq:3.5.6-management
        <span class=k>if</span> <span class=o>[</span> <span class=nv>$?</span> -gt <span class=m>1</span> <span class=o>]</span><span class=p>;</span> <span class=k>then</span>
            <span class=nb>echo</span> -e <span class=s2>&#34;\033[31m[ERROR] Rightcloud rabbitmq start failed!\033[0m&#34;</span><span class=p>;</span>
            <span class=k>return</span> 1<span class=p>;</span>
        <span class=k>fi</span>

        <span class=k>for</span> ii in <span class=o>{</span>600..0<span class=o>}</span><span class=p>;</span> <span class=k>do</span>
            <span class=k>if</span> docker <span class=nb>exec</span> -i <span class=si>${</span><span class=nv>ANYNODE_PREFIX</span><span class=si>}</span>_rabbitmq rabbitmqctl cluster_status <span class=p>&amp;</span>&gt; /dev/null<span class=p>;</span> <span class=k>then</span>
                <span class=nb>echo</span> <span class=s2>&#34;RabbitMQ is ready&#34;</span>
                <span class=nb>break</span>
            <span class=k>fi</span>
            <span class=nb>echo</span> <span class=s1>&#39;RabbitMQ init process in progress...&#39;</span>
            sleep <span class=m>1</span>
        <span class=k>done</span>

        <span class=k>if</span> <span class=o>[</span> <span class=s2>&#34;</span><span class=nv>$ii</span><span class=s2>&#34;</span> <span class=o>=</span> <span class=m>0</span> <span class=o>]</span><span class=p>;</span> <span class=k>then</span>
            <span class=nb>echo</span> &gt;<span class=p>&amp;</span><span class=m>2</span> <span class=s1>&#39;RabbitMQ init process failed.&#39;</span>
            <span class=k>return</span> <span class=m>1</span>
        <span class=k>fi</span>

        <span class=c1># sleep 60</span>

        docker <span class=nb>exec</span> <span class=si>${</span><span class=nv>ANYNODE_PREFIX</span><span class=si>}</span>_rabbitmq rabbitmqctl add_user admin <span class=m>1</span>
        docker <span class=nb>exec</span> <span class=si>${</span><span class=nv>ANYNODE_PREFIX</span><span class=si>}</span>_rabbitmq rabbitmqctl set_user_tags admin administrator
        docker <span class=nb>exec</span> <span class=si>${</span><span class=nv>ANYNODE_PREFIX</span><span class=si>}</span>_rabbitmq rabbitmqctl set_permissions admin <span class=s2>&#34;.*&#34;</span> <span class=s2>&#34;.*&#34;</span> <span class=s2>&#34;.*&#34;</span>
        sleep <span class=m>3</span>
    <span class=k>fi</span>
<span class=o>}</span>

run_haproxy<span class=o>()</span> <span class=o>{</span>
    check_container <span class=si>${</span><span class=nv>ANYNODE_PREFIX</span><span class=si>}</span>_haproxy

    <span class=k>if</span> <span class=o>[</span> <span class=nv>$?</span> <span class=o>=</span> <span class=m>1</span> <span class=o>]</span><span class=p>;</span> <span class=k>then</span>

    docker run -d  <span class=si>${</span><span class=nv>DOCKER_LOG_OPTS</span><span class=si>}</span> <span class=se>\
</span><span class=se></span>           -p <span class=si>${</span><span class=nv>MYSQL_HA_PORT</span><span class=si>}</span>:3306 <span class=se>\
</span><span class=se></span>           -p <span class=si>${</span><span class=nv>MQ_HA_PORT</span><span class=si>}</span>:5672 <span class=se>\
</span><span class=se></span>           -p <span class=si>${</span><span class=nv>REDIS_HA_PORT</span><span class=si>}</span>:6379 <span class=se>\
</span><span class=se></span>           -p <span class=si>${</span><span class=nv>MQ_MGT_HA_PORT</span><span class=si>}</span>:15672 <span class=se>\
</span><span class=se></span>           -p <span class=si>${</span><span class=nv>CONSOLE_HA_PORT</span><span class=si>}</span>:80 <span class=se>\
</span><span class=se></span>           -p <span class=si>${</span><span class=nv>CONSOLE_HA_PORT2</span><span class=si>}</span>:81 <span class=se>\
</span><span class=se></span>           -p <span class=si>${</span><span class=nv>SERVER_HA_PORT</span><span class=si>}</span>:8443 <span class=se>\
</span><span class=se></span>           -p <span class=si>${</span><span class=nv>REPOMIRROR_HA_PORT</span><span class=si>}</span>:<span class=si>${</span><span class=nv>REPOMIRROR_HA_PORT</span><span class=si>}</span> <span class=se>\
</span><span class=se></span>           -p <span class=si>${</span><span class=nv>WEBSSH_HA_PORT</span><span class=si>}</span>:4200 <span class=se>\
</span><span class=se></span>           -p 1080:1080 <span class=se>\
</span><span class=se></span>           -v /opt/haproxy:/usr/local/etc/haproxy <span class=se>\
</span><span class=se></span>           --name <span class=si>${</span><span class=nv>ANYNODE_PREFIX</span><span class=si>}</span>_haproxy <span class=se>\
</span><span class=se></span>           image.rightcloud.com.cn/library/haproxy:1.8
    <span class=k>fi</span>

<span class=o>}</span>

run_keepalived<span class=o>()</span> <span class=o>{</span>
    check_container <span class=si>${</span><span class=nv>ANYNODE_PREFIX</span><span class=si>}</span>_keepalived_master

    <span class=k>if</span> <span class=o>[</span> <span class=nv>$?</span> <span class=o>=</span> <span class=m>1</span> <span class=o>]</span><span class=p>;</span> <span class=k>then</span>

    docker run <span class=si>${</span><span class=nv>DOCKER_LOG_OPTS</span><span class=si>}</span> --cap-add<span class=o>=</span>NET_ADMIN <span class=se>\
</span><span class=se></span>           --net<span class=o>=</span>host --privileged -d <span class=se>\
</span><span class=se></span>           -v /opt/keepalived/keepalived.conf:/container/service/keepalived/assets/keepalived.conf <span class=se>\
</span><span class=se></span>           -v /opt/keepalived/check_nginx.sh:/etc/keepalived/check_nginx.sh <span class=se>\
</span><span class=se></span>           --name <span class=si>${</span><span class=nv>ANYNODE_PREFIX</span><span class=si>}</span>_keepalived_master <span class=se>\
</span><span class=se></span>           image.rightcloud.com.cn/library/keepalived:1.3.9 --copy-service
    <span class=k>fi</span>

<span class=o>}</span>

run_keepalive_slave<span class=o>()</span> <span class=o>{</span>
    check_container <span class=si>${</span><span class=nv>ANYNODE_PREFIX</span><span class=si>}</span>_keepalived_slave

    <span class=k>if</span> <span class=o>[</span> <span class=nv>$?</span> <span class=o>=</span> <span class=m>1</span> <span class=o>]</span><span class=p>;</span> <span class=k>then</span>


    docker run <span class=si>${</span><span class=nv>DOCKER_LOG_OPTS</span><span class=si>}</span> --cap-add<span class=o>=</span>NET_ADMIN <span class=se>\
</span><span class=se></span>           --net<span class=o>=</span>host --privileged -d <span class=se>\
</span><span class=se></span>           -v /opt/keepalived/keepalived.conf:/container/service/keepalived/assets/keepalived.conf <span class=se>\
</span><span class=se></span>           -v /opt/keepalived/check_nginx.sh:/etc/keepalived/check_nginx.sh <span class=se>\
</span><span class=se></span>           --name <span class=si>${</span><span class=nv>ANYNODE_PREFIX</span><span class=si>}</span>_keepalived_slave <span class=se>\
</span><span class=se></span>           image.rightcloud.com.cn/library/keepalived:1.3.9 --copy-service

    <span class=k>fi</span>
<span class=o>}</span>

<span class=k>function</span> run_redis<span class=o>()</span> <span class=o>{</span>
    check_container <span class=si>${</span><span class=nv>ANYNODE_PREFIX</span><span class=si>}</span>_redis

    <span class=k>if</span> <span class=o>[</span> <span class=nv>$?</span> <span class=o>=</span> <span class=m>1</span> <span class=o>]</span><span class=p>;</span> <span class=k>then</span>
        <span class=nb>echo</span> -e <span class=s2>&#34;\033[36m[INFO] Rightcloud redis starting...... \033[0m&#34;</span>
        docker run -d <span class=si>${</span><span class=nv>DOCKER_LOG_OPTS</span><span class=si>}</span> -p <span class=si>${</span><span class=nv>REDIS_PORT</span><span class=si>}</span>:6379 --name <span class=si>${</span><span class=nv>ANYNODE_PREFIX</span><span class=si>}</span>_redis image.rightcloud.com.cn/library/redis:latest
        <span class=k>if</span> <span class=o>[</span> <span class=nv>$?</span> -ne <span class=m>0</span> <span class=o>]</span><span class=p>;</span> <span class=k>then</span>
            <span class=nb>echo</span> -e <span class=s2>&#34;\033[31m[ERROR] Rightcloud redis start failed!\033[0m&#34;</span><span class=p>;</span>
            <span class=k>return</span> 1<span class=p>;</span>
        <span class=k>fi</span>
        sleep <span class=m>3</span>
    <span class=k>fi</span>
<span class=o>}</span>

<span class=k>function</span> run_monitor<span class=o>()</span> <span class=o>{</span>
    check_container <span class=si>${</span><span class=nv>ANYNODE_PREFIX</span><span class=si>}</span>_monitor

    <span class=k>if</span> <span class=o>[</span> <span class=nv>$?</span> <span class=o>=</span> <span class=m>1</span> <span class=o>]</span><span class=p>;</span> <span class=k>then</span>
        <span class=nb>echo</span> -e <span class=s2>&#34;\033[36m[INFO] Rightcloud monitor starting...... \033[0m&#34;</span>
        docker run -d <span class=si>${</span><span class=nv>DOCKER_LOG_OPTS</span><span class=si>}</span> <span class=se>\
</span><span class=se></span>               -p 1234:1234 <span class=se>\
</span><span class=se></span>               -p 5050:5050 <span class=se>\
</span><span class=se></span>               -p 9912:9912 <span class=se>\
</span><span class=se></span>               -p 6030:6030 <span class=se>\
</span><span class=se></span>               -p 6060:6060 <span class=se>\
</span><span class=se></span>               -p 9966:9966 <span class=se>\
</span><span class=se></span>               -p 8433:8433 <span class=se>\
</span><span class=se></span>               -p 8081:8081 <span class=se>\
</span><span class=se></span>               -p 3307:3306 <span class=se>\
</span><span class=se></span>               -v /etc/localtime:/etc/localtime <span class=se>\
</span><span class=se></span>               -e <span class=s2>&#34;HOST_IP=</span><span class=si>${</span><span class=nv>HOSTIP</span><span class=si>}</span><span class=s2>&#34;</span> <span class=se>\
</span><span class=se></span>               --name <span class=si>${</span><span class=nv>ANYNODE_PREFIX</span><span class=si>}</span>_monitor image.rightcloud.com.cn/rightcloud/rightcloud-monitor:v1.0
        <span class=k>if</span> <span class=o>[</span> <span class=nv>$?</span> -ne <span class=m>0</span> <span class=o>]</span><span class=p>;</span> <span class=k>then</span>
            <span class=nb>echo</span> -e <span class=s2>&#34;\033[31m[ERROR] Rightcloud monitor start failed!\033[0m&#34;</span><span class=p>;</span>
            <span class=k>return</span> 1<span class=p>;</span>
        <span class=k>fi</span>
        sleep <span class=m>3</span>
    <span class=k>fi</span>
<span class=o>}</span>

<span class=k>function</span> run_harbor<span class=o>()</span> <span class=o>{</span>
    sed -i <span class=s2>&#34;s/hostname =.*/hostname = </span><span class=si>${</span><span class=nv>HOSTIP</span><span class=si>}</span><span class=s2>/g&#34;</span> /opt/harbor/harbor.cfg
    docker-compose -f /opt/harbor/docker-compose.yml up -d
<span class=o>}</span>

addport<span class=o>()</span> <span class=o>{</span>
    <span class=nv>ports</span><span class=o>=(</span><span class=m>3307</span> <span class=m>6379</span> <span class=m>6060</span> <span class=m>6030</span> <span class=m>9966</span> <span class=m>9999</span> <span class=m>8080</span> <span class=m>80</span> <span class=m>8081</span> <span class=m>8433</span> <span class=m>1234</span> <span class=m>8501</span> <span class=m>15671</span> <span class=m>9912</span> <span class=m>5050</span> <span class=m>3389</span> <span class=m>5671</span> <span class=m>8808</span> <span class=m>8809</span> <span class=m>1514</span> <span class=m>3306</span> 3690<span class=o>)</span>
    <span class=k>for</span> p in <span class=si>${</span><span class=nv>ports</span><span class=p>[@]</span><span class=si>}</span><span class=p>;</span> <span class=k>do</span>
        firewall-cmd --add-port<span class=o>=</span><span class=si>${</span><span class=nv>p</span><span class=si>}</span>/tcp --zone<span class=o>=</span>public
        firewall-cmd --permanent --add-port<span class=o>=</span><span class=si>${</span><span class=nv>p</span><span class=si>}</span>/tcp --zone<span class=o>=</span>public
    <span class=k>done</span>
<span class=o>}</span>

removeport<span class=o>()</span> <span class=o>{</span>
    <span class=nv>ports</span><span class=o>=(</span><span class=m>3307</span> <span class=m>6379</span> <span class=m>6060</span> <span class=m>6030</span> <span class=m>9966</span> <span class=m>9999</span> <span class=m>8080</span> <span class=m>80</span> <span class=m>8081</span> <span class=m>8433</span> <span class=m>1234</span> <span class=m>8501</span> <span class=m>15671</span> <span class=m>9912</span> <span class=m>5050</span> <span class=m>3389</span> <span class=m>5671</span> <span class=m>8808</span> <span class=m>8809</span> <span class=m>1514</span> <span class=m>3306</span> 3690<span class=o>)</span>
    <span class=k>for</span> p in <span class=si>${</span><span class=nv>ports</span><span class=p>[@]</span><span class=si>}</span><span class=p>;</span> <span class=k>do</span>
        firewall-cmd --permanent --remove-port<span class=o>=</span><span class=si>${</span><span class=nv>p</span><span class=si>}</span>/tcp --zone<span class=o>=</span>public
    <span class=k>done</span>
<span class=o>}</span>

deploy-server<span class=o>()</span> <span class=o>{</span>
    <span class=k>if</span> <span class=o>[</span> <span class=s2>&#34;x</span><span class=nv>$1</span><span class=s2>&#34;</span> <span class=o>=</span> <span class=s2>&#34;x&#34;</span> <span class=o>]</span><span class=p>;</span> <span class=k>then</span>
        <span class=nb>echo</span> <span class=s2>&#34;Please specify the server_tag&#34;</span>
        <span class=k>return</span> <span class=m>1</span>
    <span class=k>fi</span>
    sed -i <span class=s2>&#34;s!SERVER_TAG=.*!SERVER_TAG=</span><span class=nv>$1</span><span class=s2>!g&#34;</span> <span class=si>${</span><span class=nv>WORKDIR</span><span class=si>}</span>/rightcloud_var_ha
    . <span class=si>${</span><span class=nv>WORKDIR</span><span class=si>}</span>/rightcloud_var_ha
    run_server
<span class=o>}</span>

deploy-portal<span class=o>()</span> <span class=o>{</span>
    <span class=k>if</span> <span class=o>[</span> <span class=s2>&#34;x</span><span class=nv>$1</span><span class=s2>&#34;</span> <span class=o>=</span> <span class=s2>&#34;x&#34;</span> <span class=o>]</span><span class=p>;</span> <span class=k>then</span>
        <span class=nb>echo</span> <span class=s2>&#34;Please specify the portal_tag&#34;</span>
        <span class=k>return</span> <span class=m>1</span>
    <span class=k>fi</span>
    sed -i <span class=s2>&#34;s!PORTAL_TAG=.*!PORTAL_TAG=</span><span class=nv>$1</span><span class=s2>!g&#34;</span> <span class=si>${</span><span class=nv>WORKDIR</span><span class=si>}</span>/rightcloud_var_ha
    . <span class=si>${</span><span class=nv>WORKDIR</span><span class=si>}</span>/rightcloud_var_ha
    run_portal
<span class=o>}</span>

deploy-console<span class=o>()</span> <span class=o>{</span>
    <span class=k>if</span> <span class=o>[</span> <span class=s2>&#34;x</span><span class=nv>$1</span><span class=s2>&#34;</span> <span class=o>=</span> <span class=s2>&#34;x&#34;</span> <span class=o>]</span><span class=p>;</span> <span class=k>then</span>
        <span class=nb>echo</span> <span class=s2>&#34;Please specify the console_tag&#34;</span>
        <span class=k>return</span> <span class=m>1</span>
    <span class=k>fi</span>
    sed -i <span class=s2>&#34;s!CONSOLE_TAG=.*!CONSOLE_TAG=</span><span class=nv>$1</span><span class=s2>!g&#34;</span> <span class=si>${</span><span class=nv>WORKDIR</span><span class=si>}</span>/rightcloud_var_ha
    . <span class=si>${</span><span class=nv>WORKDIR</span><span class=si>}</span>/rightcloud_var_ha
    run_console
<span class=o>}</span>

deploy-schedule<span class=o>()</span> <span class=o>{</span>
    <span class=k>if</span> <span class=o>[</span> <span class=s2>&#34;x</span><span class=nv>$1</span><span class=s2>&#34;</span> <span class=o>=</span> <span class=s2>&#34;x&#34;</span> <span class=o>]</span><span class=p>;</span> <span class=k>then</span>
        <span class=nb>echo</span> <span class=s2>&#34;Please specify the schedule_tag&#34;</span>
        <span class=k>return</span> <span class=m>1</span>
    <span class=k>fi</span>
    sed -i <span class=s2>&#34;s!SCHEDULE_TAG=.*!SCHEDULE_TAG=</span><span class=nv>$1</span><span class=s2>!g&#34;</span> <span class=si>${</span><span class=nv>WORKDIR</span><span class=si>}</span>/rightcloud_var_ha
    . <span class=si>${</span><span class=nv>WORKDIR</span><span class=si>}</span>/rightcloud_var_ha
    run_schedule
<span class=o>}</span>

deploy-ansible<span class=o>()</span> <span class=o>{</span>
    <span class=k>if</span> <span class=o>[</span> <span class=s2>&#34;x</span><span class=nv>$1</span><span class=s2>&#34;</span> <span class=o>=</span> <span class=s2>&#34;x&#34;</span> <span class=o>]</span><span class=p>;</span> <span class=k>then</span>
        <span class=nb>echo</span> <span class=s2>&#34;Please specify the ansible_tag&#34;</span>
        <span class=k>return</span> <span class=m>1</span>
    <span class=k>fi</span>
    sed -i <span class=s2>&#34;s!ANSIBLE_TAG=.*!ANSIBLE_TAG=</span><span class=nv>$1</span><span class=s2>!g&#34;</span> <span class=si>${</span><span class=nv>WORKDIR</span><span class=si>}</span>/rightcloud_var_ha
    . <span class=si>${</span><span class=nv>WORKDIR</span><span class=si>}</span>/rightcloud_var_ha
    run_ansible
<span class=o>}</span>

deploy-adapter<span class=o>()</span> <span class=o>{</span>
    <span class=k>if</span> <span class=o>[</span> <span class=s2>&#34;x</span><span class=nv>$1</span><span class=s2>&#34;</span> <span class=o>=</span> <span class=s2>&#34;x&#34;</span> <span class=o>]</span><span class=p>;</span> <span class=k>then</span>
        <span class=nb>echo</span> <span class=s2>&#34;Please specify the adapter_tag&#34;</span>
        <span class=k>return</span> <span class=m>1</span>
    <span class=k>fi</span>
    sed -i <span class=s2>&#34;s!ADAPTER_TAG=.*!ADAPTER_TAG=</span><span class=nv>$1</span><span class=s2>!g&#34;</span> <span class=si>${</span><span class=nv>WORKDIR</span><span class=si>}</span>/rightcloud_var_ha
    . <span class=si>${</span><span class=nv>WORKDIR</span><span class=si>}</span>/rightcloud_var_ha
    run_adapter
<span class=o>}</span>

deploy-dbmigration<span class=o>()</span> <span class=o>{</span>
    <span class=k>if</span> <span class=o>[</span> <span class=s2>&#34;x</span><span class=nv>$1</span><span class=s2>&#34;</span> <span class=o>=</span> <span class=s2>&#34;x&#34;</span> <span class=o>]</span><span class=p>;</span> <span class=k>then</span>
        <span class=nb>echo</span> <span class=s2>&#34;Please specify the db_migration_tag&#34;</span>
        <span class=k>return</span> <span class=m>1</span>
    <span class=k>fi</span>
    sed -i <span class=s2>&#34;s!DB_MIGRATION_TAG=.*!DB_MIGRATION_TAG=</span><span class=nv>$1</span><span class=s2>!g&#34;</span> <span class=si>${</span><span class=nv>WORKDIR</span><span class=si>}</span>/rightcloud_var_ha
    . <span class=si>${</span><span class=nv>WORKDIR</span><span class=si>}</span>/rightcloud_var_ha
    run_dbmigration
<span class=o>}</span>

check_container_status<span class=o>()</span> <span class=o>{</span>
    <span class=k>if</span> <span class=o>[</span> <span class=s2>&#34;x</span><span class=nv>$1</span><span class=s2>&#34;</span> <span class=o>=</span> <span class=s2>&#34;x&#34;</span> <span class=o>]</span><span class=p>;</span> <span class=k>then</span>
        <span class=nb>echo</span> <span class=s2>&#34;Please provide container_name for checking&#34;</span>
        <span class=k>return</span>
    <span class=k>fi</span>

    <span class=nv>RUNNING</span><span class=o>=</span><span class=sb>`</span>docker ps -q<span class=p>|</span>xargs docker inspect -f <span class=s1>&#39;{{.Name}}&#39;</span><span class=p>|</span>grep <span class=nv>$1</span> <span class=p>|</span>grep -v grep<span class=p>|</span>wc -l<span class=p>|</span>tr -d <span class=s2>&#34; &#34;</span><span class=sb>`</span>

    <span class=k>if</span> <span class=o>[</span> <span class=nv>$RUNNING</span> !<span class=o>=</span> <span class=m>0</span> <span class=o>]</span><span class=p>;</span> <span class=k>then</span>
        <span class=nb>echo</span> -e <span class=s2>&#34;</span><span class=nv>$1</span><span class=s2> is\033[1;32m running \033[0m&#34;</span>
    <span class=k>else</span>
        <span class=nb>echo</span> -e <span class=s2>&#34;</span><span class=nv>$1</span><span class=s2> is\033[1;31m not running \033[0m&#34;</span>
    <span class=k>fi</span>
<span class=o>}</span>


rightcloud_start<span class=o>(){</span>
    <span class=c1>#prompt_input_ip</span>
    <span class=nb>echo</span> <span class=s1>&#39;starting rightcloud service...&#39;</span>
    . /usr/local/rightcloud/rightcloud_env
    systemctl start docker
    run_repomirror
    run_harbor
    run_rabbitmq
    run_mysql
    run_redis
    run_mongo
    run_monitor
    run_webssh3
    <span class=c1>#run_portal</span>
    run_server
    run_adapter
    run_ansible
    run_console
    run_schedule
<span class=o>}</span>

rightcloud_stop<span class=o>(){</span>
    <span class=nb>echo</span> <span class=s1>&#39;stopping rightcloud service...&#39;</span>
    docker ps -a<span class=p>|</span>xargs docker <span class=nb>kill</span> <span class=p>&amp;</span>&gt; /dev/null
    <span class=c1>#cd /opt/harbor &amp;&amp; docker-compose stop</span>
    <span class=c1>#docker ps -q|xargs docker kill &amp;&gt; /dev/null</span>
<span class=o>}</span>

rightcloud_restart<span class=o>()</span> <span class=o>{</span>
    <span class=nb>echo</span> <span class=s2>&#34;restarting rightlcoud service...&#34;</span>
    rightcloud_stop
    sleep <span class=m>10</span>
    rightcloud_start
<span class=o>}</span>

rightcloud_status<span class=o>()</span> <span class=o>{</span>
    . /usr/local/rightcloud/rightcloud_env
    check_container_status <span class=s2>&#34;rightcloud_mysql&#34;</span>
    check_container_status <span class=s2>&#34;rightcloud_redis&#34;</span>
    check_container_status <span class=s2>&#34;rightcloud_rabbitmq&#34;</span>
    check_container_status <span class=s2>&#34;rightcloud_monitor&#34;</span>
    check_container_status <span class=s2>&#34;rightcloud_webssh3&#34;</span>
    check_container_status <span class=s2>&#34;rightcloud_mongo&#34;</span>
    check_container_status <span class=s2>&#34;rightcloud_server&#34;</span>
    check_container_status <span class=s2>&#34;rightcloud_adapter&#34;</span>
    check_container_status <span class=s2>&#34;rightcloud_ansible&#34;</span>
    check_container_status <span class=s2>&#34;rightcloud_repomirror&#34;</span>
    check_container_status <span class=s2>&#34;rightcloud_console&#34;</span>
    check_container_status <span class=s2>&#34;rightcloud_schedule&#34;</span>
    check_container_status <span class=s2>&#34;harbor-jobservice&#34;</span>
    check_container_status <span class=s2>&#34;harbor-db&#34;</span>
    check_container_status <span class=s2>&#34;registry&#34;</span>
    check_container_status <span class=s2>&#34;harbor-ui&#34;</span>
    check_container_status <span class=s2>&#34;harbor-log&#34;</span>
    check_container_status <span class=s2>&#34;nginx&#34;</span>
<span class=o>}</span>
</code></pre></td></tr></table></div></div><h3 id=数据库初始化>数据库初始化</h3><p>首先需要拿到db base的sql，这个找相关人拿，拿到之后导入进去：</p><p>创建数据库，权限自行控制。</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span></code></pre></td><td class=lntd><pre class=chroma><code class=language-sql data-lang=sql><span class=k>create</span><span class=w> </span><span class=k>database</span><span class=w> </span><span class=k>if</span><span class=w> </span><span class=k>not</span><span class=w> </span><span class=k>exists</span><span class=w> </span><span class=n>rightcloud</span><span class=w> </span><span class=nb>character</span><span class=w> </span><span class=k>set</span><span class=w> </span><span class=n>UTF8mb4</span><span class=w> </span><span class=k>collate</span><span class=w> </span><span class=n>utf8mb4_bin</span><span class=p>;</span><span class=w>
</span><span class=w></span><span class=k>ALTER</span><span class=w> </span><span class=k>USER</span><span class=w> </span><span class=s1>&#39;root&#39;</span><span class=o>@</span><span class=s1>&#39;%&#39;</span><span class=w> </span><span class=n>IDENTIFIED</span><span class=w> </span><span class=k>BY</span><span class=w> </span><span class=s1>&#39;root-mysql-pw&#39;</span><span class=p>;</span><span class=w>
</span><span class=w></span><span class=k>GRANT</span><span class=w> </span><span class=k>ALL</span><span class=w> </span><span class=k>PRIVILEGES</span><span class=w> </span><span class=k>ON</span><span class=w> </span><span class=o>*</span><span class=p>.</span><span class=o>*</span><span class=w> </span><span class=k>TO</span><span class=w> </span><span class=s1>&#39;root&#39;</span><span class=o>@</span><span class=s1>&#39;%&#39;</span><span class=w> </span><span class=n>IDENTIFIED</span><span class=w> </span><span class=k>BY</span><span class=w> </span><span class=s1>&#39;root-mysql-pw&#39;</span><span class=p>;</span><span class=w>
</span><span class=w></span><span class=k>ALTER</span><span class=w> </span><span class=k>USER</span><span class=w> </span><span class=s1>&#39;root&#39;</span><span class=o>@</span><span class=s1>&#39;localhost&#39;</span><span class=w> </span><span class=n>IDENTIFIED</span><span class=w> </span><span class=k>BY</span><span class=w> </span><span class=s1>&#39;root-mysql-pw&#39;</span><span class=p>;</span><span class=w>
</span></code></pre></td></tr></table></div></div><p>导入数据，假如这里的处初始化数据为 <code>rightcloud.sql</code></p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre class=chroma><code class=language-sh data-lang=sh>mysql -uroot -h xxxxxx -p rightcloud &lt; rightcloud.sql
</code></pre></td></tr></table></div></div><h3 id=注入ip相关的配置>注入ip相关的配置</h3><p>首先需要 <code>source</code> 一下 <code>rightcloud_env_ha</code> 这个文件</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre class=chroma><code class=language-sh data-lang=sh>. /usr/local/rightcloud_env_ha
</code></pre></td></tr></table></div></div><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre class=chroma><code class=language-sh data-lang=sh>gen_sql_update
</code></pre></td></tr></table></div></div><p>这里会在当前目录生成 <code>b1.sql</code>, 导入</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre class=chroma><code class=language-sh data-lang=sh>mysql -uroot -h xxxxxx -p rightcloud &lt; b1.sql
</code></pre></td></tr></table></div></div><h3 id=db-migration>db migration</h3><p>首先需要 <code>source</code> 一下 <code>rightcloud_env_ha</code> 这个文件</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre class=chroma><code class=language-sh data-lang=sh>. /usr/local/rightcloud_env_ha
</code></pre></td></tr></table></div></div><p>然后做dbmigration</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre class=chroma><code class=language-sh data-lang=sh>deploy-dbmigration db-migration-tag
</code></pre></td></tr></table></div></div><h3 id=禁用云环境>禁用云环境</h3><p>这个找相关的人要sql</p><h3 id=运行>运行</h3><p>首先需要 <code>source</code> 一下 <code>rightcloud_env_ha</code> 这个文件</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre class=chroma><code class=language-sh data-lang=sh>. /usr/local/rightcloud_env_ha
</code></pre></td></tr></table></div></div><p>然后就可以运行相应的组件了:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span></code></pre></td><td class=lntd><pre class=chroma><code class=language-sh data-lang=sh>run_server
run_adapter
...
</code></pre></td></tr></table></div></div><p>如果需要升级一下对应的组件：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td><td class=lntd><pre class=chroma><code class=language-sh data-lang=sh>deploy-server server_docker_image_tag
...
</code></pre></td></tr></table></div></div></div><div class=post-copyright><p class=copyright-item><span class=item-title>文章作者</span>
<span class=item-content>Chen, Zai-Chun</span></p><p class=copyright-item><span class=item-title>上次更新</span>
<span class=item-content>0001-01-01</span></p><p class=copyright-item><span class=item-title>许可协议</span>
<span class=item-content><a rel="license noopener" href=https://creativecommons.org/licenses/by-nc-nd/4.0/ target=_blank>CC BY-NC-ND 4.0</a></span></p></div><footer class=post-footer><nav class=post-nav><a class=prev href=/post/k8s_create_env/><i class="iconfont icon-left"></i>
<span class="prev-text nav-default">kuberntes 快速构建环境操作及流程</span>
<span class="prev-text nav-mobile">上一篇</span></a></nav></footer></article></div><div id=gitalk-container></div><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/gitalk@1/dist/gitalk.css crossorigin=anonymous><script src=https://cdn.jsdelivr.net/npm/gitalk@1/dist/gitalk.min.js crossorigin=anonymous></script><script type=text/javascript>var gitalk=new Gitalk({id:'0001-01-01 00:00:00 \u002b0000 UTC',title:'高可用部署cmp相关脚本',clientID:'069dfcb7a556cb293b47',clientSecret:'1d363446ddb5a4aa2bbad9d0b23ac78eca00f3ad',repo:'chenzaichun.github.io',owner:'chenzaichun',admin:['chenzaichun'],body:decodeURI(location.href)});gitalk.render('gitalk-container')</script><noscript>Please enable JavaScript to view the <a href=https://github.com/gitalk/gitalk>comments powered by gitalk.</a></noscript></div></main><footer id=footer class=footer><div class=social-links><a href=mailto:ChenZaichun@gmail.com class="iconfont icon-email" title=email></a><a href=https://twitter.com/chenzaichun class="iconfont icon-twitter" title=twitter></a><a href=https://facebook.com/chenzaichun class="iconfont icon-facebook" title=facebook></a><a href=https://github.com/chenzaichun class="iconfont icon-github" title=github></a><a href=https://weibo.com/archlinux class="iconfont icon-weibo" title=weibo></a><a href=https://chenzaichun.github.io/index.xml type=application/rss+xml class="iconfont icon-rss" title=rss></a></div><div class=copyright><span class=power-by>由 <a class=hexo-link href=https://gohugo.io>Hugo</a> 强力驱动</span>
<span class=division>|</span>
<span class=theme-info>主题 -
<a class=theme-link href=https://github.com/olOwOlo/hugo-theme-even>Even</a></span>
<span class=copyright-year>&copy;
2009 -
2021<span class=heart><i class="iconfont icon-heart"></i></span><span>Chen, Zai-Chun</span></span></div></footer><div class=back-to-top id=back-to-top><i class="iconfont icon-up"></i></div></div><script src=https://cdn.jsdelivr.net/npm/jquery@3.2.1/dist/jquery.min.js integrity="sha256-hwg4gsxgFZhOsEEamdOYGBf13FyQuiTwlAQgxVSNgt4=" crossorigin=anonymous></script><script src=https://cdn.jsdelivr.net/npm/slideout@1.0.1/dist/slideout.min.js integrity="sha256-t+zJ/g8/KXIJMjSVQdnibt4dlaDxc9zXr/9oNPeWqdg=" crossorigin=anonymous></script><script src=https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@3.1.20/dist/jquery.fancybox.min.js integrity="sha256-XVLffZaxoWfGUEbdzuLi7pwaUJv1cecsQJQqGLe7axY=" crossorigin=anonymous></script><script src=https://cdn.jsdelivr.net/npm/timeago.js@3.0.2/dist/timeago.min.js integrity="sha256-jwCP0NAdCBloaIWTWHmW4i3snUNMHUNO+jr9rYd2iOI=" crossorigin=anonymous></script><script src=https://cdn.jsdelivr.net/npm/timeago.js@3.0.2/dist/timeago.locales.min.js integrity="sha256-ZwofwC1Lf/faQCzN7nZtfijVV6hSwxjQMwXL4gn9qU8=" crossorigin=anonymous></script><script>var languageCode="en".replace(/-/g,'_').replace(/_(.*)/,function(b,a){return b.replace(a,a.toUpperCase())});timeago().render(document.querySelectorAll('.timeago'),languageCode),timeago.cancel()</script><script src=https://cdn.jsdelivr.net/npm/raphael@2.2.7/raphael.min.js integrity="sha256-67By+NpOtm9ka1R6xpUefeGOY8kWWHHRAKlvaTJ7ONI=" crossorigin=anonymous></script><script src=https://cdn.jsdelivr.net/npm/flowchart.js@1.8.0/release/flowchart.min.js integrity="sha256-zNGWjubXoY6rb5MnmpBNefO0RgoVYfle9p0tvOQM+6k=" crossorigin=anonymous></script><script src=https://cdn.jsdelivr.net/npm/webfontloader@1.6.28/webfontloader.js integrity="sha256-4O4pS1SH31ZqrSO2A/2QJTVjTPqVe+jnYgOWUVr7EEc=" crossorigin=anonymous></script><script src=https://cdn.jsdelivr.net/npm/snapsvg@0.5.1/dist/snap.svg-min.js integrity="sha256-oI+elz+sIm+jpn8F/qEspKoKveTc5uKeFHNNVexe6d8=" crossorigin=anonymous></script><script src=https://cdn.jsdelivr.net/npm/underscore@1.8.3/underscore-min.js integrity="sha256-obZACiHd7gkOk9iIL/pimWMTJ4W/pBsKu+oZnSeBIek=" crossorigin=anonymous></script><script src=https://cdn.jsdelivr.net/gh/bramp/js-sequence-diagrams@2.0.1/dist/sequence-diagram-min.js integrity=sha384-8748Vn52gHJYJI0XEuPB2QlPVNUkJlJn9tHqKec6J3q2r9l8fvRxrgn/E5ZHV0sP crossorigin=anonymous></script><link rel=stylesheet href=https://cdn.jsdelivr.net/gh/bramp/js-sequence-diagrams@2.0.1/dist/sequence-diagram-min.css integrity=sha384-6QbLKJMz5dS3adWSeINZe74uSydBGFbnzaAYmp+tKyq60S7H2p6V7g1TysM5lAaF crossorigin=anonymous><script type=text/javascript src=/js/main.min.c99b103c33d1539acf3025e1913697534542c4a5aa5af0ccc20475ed2863603b.js></script><script type=text/javascript>window.MathJax={tex:{inlineMath:[['$','$'],['\\(','\\)']],tags:'ams'}}</script><script async src=https://cdn.jsdelivr.net/npm/mathjax@3.0.5/es5/tex-mml-chtml.js integrity="sha256-HGLuEfFcsUJGhvB8cQ8nr0gai9EucOOaIxFw7qxmd+w=" crossorigin=anonymous></script></body></html>